_ï¼ˆç›®å‰æ–‡ç« ç‹€æ…‹ï¼šè‰ç¨¿ï¼‰_

æ–‡ç« æ¨™é¡Œï¼šApp Router vs Pages Router in Next.js

# å‰è¨€

æ­¤ç¯‡æ–‡ç« çš„ç›®çš„åœ¨æ–¼ï¼Œäº†è§£ App Router å’Œ Pages Router ä¹‹é–“çš„å·®ç•°ï¼Œä»¥ä¾¿æ–¼åˆ¤æ–·ä¹‹å¾Œçš„å°ˆæ¡ˆæ˜¯å¦è¦æ”¹ç”¨ App Routerã€‚ï¼ˆç›®å‰çš„å°ˆæ¡ˆéƒ½æ˜¯ä½¿ç”¨ Pages Routerï¼‰

é¦–å…ˆæœƒå…ˆç°¡å–®ä»‹ç´¹ Next.jsï¼Œå†ä¾†æ˜¯é‡å° App Router èˆ‡ Page Router çš„å·®ç•°é€²è¡Œæ¯”è¼ƒï¼Œä¸¦ä»‹ç´¹ App Router çš„å¹¾å€‹é‡è¦åŠŸèƒ½ï¼Œæœ€å¾Œæœƒåšä¸€å€‹å¯¦ä½œã€‚

æ­¤ç¯‡æ–‡ç« çš„å…§å®¹å¤§éƒ¨åˆ†éƒ½æœƒç”±å®˜æ–¹æ–‡ä»¶åŠç¶²è·¯ä¸Šéƒ¨è½æ ¼æ–‡ç« æ“·å–è€Œæˆï¼Œæ‰€æœ‰è³‡æ–™ä¾†æºæœƒæ•´ç†æ–¼æœ¬æ–‡çš„æœ€å¾Œä¸€å€‹ç« ç¯€ã€Œåƒè€ƒè³‡æ–™ã€è£¡é¢ã€‚

## åˆæ­¥èªè­˜ Next.js

### 1. React vs Next.jsï¼šå‡½å¼åº«èˆ‡æ¡†æ¶

React æ˜¯ç”¨ä¾†å»ºæ§‹ä½¿ç”¨è€…ä»‹é¢çš„ JavaScript å‡½å¼åº«ï¼ˆLibraryï¼‰ã€‚

è€Œ Next.js å‰‡æ˜¯å»ºç«‹ React ä¹‹ä¸Šçš„æ¡†æ¶ï¼Œé™¤äº†å®¢æˆ¶ç«¯æ¸²æŸ“ï¼ˆClient-side Renderingï¼‰ï¼Œé‚„æ”¯æ´å…©ç¨®å½¢å¼çš„é æ¸²æŸ“ï¼šéœæ…‹ç¶²é ç”Ÿæˆï¼ˆStatic Site Generationï¼‰å’Œä¼ºæœå™¨ç«¯æ¸²æŸ“ï¼ˆServer-side Renderingï¼‰ã€‚

å¯åƒè€ƒå®˜ç¶²çš„æ¨™èªä»‹ç´¹ï¼š

- [React](https://react.dev/)ï¼šç”¨æ–¼æ‰“é€ ä½¿ç”¨è€…ä»‹é¢çš„å‡½å¼åº«ï¼ˆTheÂ **library**Â for web and native user interfacesï¼‰
  - æ­¤å¤–å®˜æ–¹ä¹Ÿæåˆ°ï¼šã€Œå»ºè­°ä½¿ç”¨è€…ä½¿ç”¨å…¨ç«¯ React æ¡†æ¶ï¼Œå¦‚ Next.js æˆ– Â [Remix](https://remix.run/)ï¼Œä»¥è™•ç†å°ˆæ¡ˆä¸­çš„è·¯ç”±èˆ‡è³‡æ–™è™•ç†ç­‰éœ€æ±‚ã€
- [Next.js](https://nextjs.org/)ï¼šç”¨æ–¼ç¶²é é–‹ç™¼çš„ React æ¡†æ¶ï¼ˆThe ReactÂ **Framework**Â for the Webï¼‰

#### è£œå……â€”â€”React æ˜¯ä¸æ˜¯æ¡†æ¶ï¼Ÿ

ç‚ºä»€éº¼å¸¸å¸¸è½åˆ°æœ‰äººèªª React æ˜¯ä¸€å€‹ Javascript library ä¸æ˜¯ä¸€å€‹æ¡†æ¶ï¼Ÿç©¶ç«Ÿ library å’Œ Framework å…©è€…å·®åœ¨å“ªè£¡å‘¢ï¼Ÿ

é–‹ç™¼ä¸€å€‹ app åŒ…å«äº†è¨±å¤šé¢å‘ï¼Œåƒæ˜¯ UIã€routingã€data fetchingã€renderingã€éƒ¨ç½²ç­‰ç­‰ï¼Œè€Œä¸€å€‹ã€Œæ¡†æ¶ã€æ‡‰è©²è¦èƒ½å…¨é¢åœ° cover é€™äº›éœ€æ±‚ã€‚

å‡å¦‚ç¿’æ…£ä½¿ç”¨åƒæ˜¯ create-react-app é€™äº› boilerplate ä¾†å»ºç«‹ React å°ˆæ¡ˆçš„äººï¼Œå¯èƒ½æœƒä»¥ç‚º React æœ¬èº«ä¸€æ‰‹åŒ…è¾¦äº†æ‰€æœ‰äº‹æƒ…ã€‚ä½†å…¶å¯¦æ‰“é–‹ create-react-app å°ˆæ¡ˆçš„ package.json æª”æ¡ˆï¼Œæˆ‘å€‘æœƒç™¼ç¾å®ƒåªå¹«æˆ‘å€‘å…ˆè£å¥½äº†å¸¸ç”¨çš„å¥—ä»¶ï¼Œåƒæ˜¯ React-DOMã€Webpack ç­‰ç­‰ã€‚**äº‹å¯¦ä¸Š React æœ¬èº«åªè² è²¬ UI çš„å»ºé€ ï¼Œå…¶é¤˜å·¥ä½œå¿…é ˆäº¤çµ¦å…¶ä»–ç¬¬ä¸‰æ–¹å¥—ä»¶åŸ·è¡Œ**ï¼Œåƒæ˜¯ React-DOM è² è²¬çœŸå¯¦æ“æ§ DOMã€React-Router è² è²¬è·¯ç”±åˆ‡æ›ç­‰ç­‰ï¼Œå› æ­¤æœƒèªª React åªæ˜¯ä¸€å€‹ libraryã€‚

Library å¥½è™•æ˜¯è®“å°ˆæ¡ˆçš„è‡ªç”±åº¦é«˜ï¼Œé–‹ç™¼è€…å¯ä¾éœ€æ±‚è‡ªç”±æŒ‘é¸å·¥å…·ï¼Œåƒæ˜¯å¯ä½¿ç”¨ä¸åŒ React Renderer (ex: React Native) å°‡ UI æ¸²æŸ“åˆ°ä¸åŒè£ç½®ä¸Šï¼Œä¸”é€šå¸¸èˆ‡ç¬¬ä¸‰æ–¹å¥—ä»¶çš„ç›¸å®¹æ€§ä¹Ÿæœƒæ¯”è¼ƒé«˜ï¼›ä½†è‡ªç”±åº¦é«˜ä¹Ÿæ„å‘³è‘—éœ€è¦é¡å¤–èŠ±æ™‚é–“ç²¾åŠ›ä¾†é¸æ“‡ã€è¨­å®šå„å¼å·¥å…·ã€‚

ç›¸è¼ƒæ–¼ libraryï¼Œæ¡†æ¶å‰‡æä¾›è¼ƒç‚ºå®Œæ•´çš„ solutionsï¼Œè€Œ Â **Next.js é™¤äº†æ•´åˆ React.js è² è²¬ UI å»ºé€ å¤–ï¼Œä¹Ÿæä¾›äº† routingã€renderingã€data fetchingã€integrations ç­‰ä»»å‹™çš„è§£æ±ºæ–¹æ¡ˆã€‚**

ä½† React åˆ°åº•æ˜¯å€‹ library é‚„æ˜¯æ¡†æ¶ï¼Œå…¶å¯¦ä¸€ç›´å­˜åœ¨ä¸åŒçš„è§€é»ã€‚åƒä»Šå¹´ React core team çš„æˆå“¡ä¹‹ä¸€ Sebastian åœ¨æ¥å— Vercel çš„[è¨ªè«‡](https://www.youtube.com/watch?v=g5BGoLyGjY0&t=1076s)æ™‚ï¼Œæåˆ° React ä¹Ÿæ˜¯ç”¨ framework é€™å€‹è©ï¼Œä»–ä¹Ÿèªªä»–æ²’å¾ˆåœ¨æ„åˆ°åº•è©²èªª library é‚„æ˜¯ frameworkï¼Œæ‰€ä»¥é€™éƒ¨åˆ†æˆ–è¨±æŒºè¦‹ä»è¦‹æ™ºã€‚

### 2. ç‚ºä»€éº¼é¸æ“‡ Next.js

Angularã€Reactã€Vueï¼Œä¹Ÿå°±æ˜¯ä¿—ç¨±çš„å‰ç«¯ä¸‰å¤§ã€Œæ¡†æ¶ã€ï¼Œå¸¸ç”¨æ–¼å¿«é€Ÿé–‹ç™¼å–®é å¼æ‡‰ç”¨ç¨‹å¼ï¼ˆSingle Page Applicationï¼ŒSPAï¼‰ï¼Œå¯é”åˆ°å‰å¾Œç«¯åˆ†é›¢ï¼Œä»¥åŠæå‡ä½¿ç”¨è€…é«”é©—ç­‰ç›®çš„ï¼Œä¾‹å¦‚ Gmailã€Facebook å’Œ Netflix ç­‰å¹³å°ã€‚

ç„¶è€Œï¼Œç”±æ–¼ SPA æ˜¯åˆ©ç”¨å®¢æˆ¶ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰æŠ€è¡“ï¼Œç”± JavaScript å‹•æ…‹ç”¢ç”Ÿå…§å®¹ï¼Œè‹¥æª¢è¦–åŸå§‹ç¢¼æœƒç™¼ç¾ç„¡æ³•çœ‹åˆ°æ–°å¢çš„å…§å®¹ï¼Œé€™å°‡å°è‡´ SEOï¼ˆæœå°‹å¼•æ“æœ€ä½³åŒ–ï¼‰è¼ƒå·®çš„å•é¡Œï¼›ä¹Ÿå› ç‚ºåˆæ¬¡è¼‰å…¥é é¢éœ€ä¸‹è¼‰å¤§é‡çš„ JavaScript æª”æ¡ˆï¼Œä½¿ç¬¬ä¸€æ¬¡æ¸²æŸ“è¼ƒç‚ºè²»æ™‚ï¼Œåè€Œé™ä½ä½¿ç”¨è€…é«”é©—ã€‚

é‚£è©²æ€éº¼è¾¦å‘¢ï¼Ÿ

åªè¦ç¬¬ä¸€å€‹ç•«é¢æ”¹ç”±ä¼ºæœå™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ï¼Œå³å¯è§£æ±º SEO å•é¡Œï¼Œå…¶ä»–ç•«é¢ä»ç¶­æŒä½¿ç”¨è€…ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰ï¼Œæ¸›å°‘ä¼ºæœå™¨é‹ç®—è² è·ï¼Œå¦‚æ­¤ä¸å°±èƒ½å¤ å…©è€…å…¼å¾—äº†å—ï¼Ÿ

React å¯é€éã€Œæ­å»ºå¾Œç«¯ Server + è™•ç† Hydration + Webpack æ‰“åŒ…é…ç½®ã€ç­‰è¨­å®šä¾†å¯¦ç¾ SSRï¼Œä½†ç›¸å°ä¾†èªªé–€æª»è¼ƒé«˜ï¼Œéœ€è€—è²»è¼ƒå¤šæˆæœ¬å­¸ç¿’ã€‚

æ–¼æ˜¯å‰ç«¯ SSR æ¡†æ¶å°±èª•ç”Ÿäº†ï¼Œå¦‚ React çš„ Â [Next.js](https://nextjs.org/)Â  å’Œ Â [Gatsby.js](https://www.gatsbyjs.com/)ï¼Œä»¥åŠ Vue çš„ Â [Nuxt.js](https://nuxt.com/)ã€‚

### 3. Next.js ç‰¹è‰²

ç”± Â [Vercel](https://github.com/vercel/next.js)Â  åœ˜éšŠå‰µå»ºçš„ Next.jsï¼Œè§£æ±ºäº†ä¸Šè¿°å¹¾é»ç¶²é é–‹ç™¼é‡åˆ°çš„å•é¡Œï¼Œä»¥ä¸‹æ˜¯å®˜ç¶²æåŠæœ‰é—œ Next.js v14ï¼ˆç™¼å¸ƒæ–¼ 2023 å¹´ 12 æœˆï¼‰çš„å¹¾é …ç‰¹é»ï¼š

- Data Fetchingï¼šå¯æ§åˆ¶è³‡æ–™è¼‰å…¥çš„æ™‚æ©Ÿé»
- CSS Supportï¼šå…§å»ºæ”¯æ´ CSSã€Sass æª”æ¡ˆï¼Œä¸¦æ”¯æ´ CSS æ¨¡çµ„åŒ–
- Route Handlersï¼šåŸºæ–¼æª”æ¡ˆæ¶æ§‹çš„è·¯ç”±ç³»çµ±ï¼Œå¦‚ Â `page/home.tsx`
- API Routesï¼šæ”¯æ´ API è·¯ç”±ï¼Œæ˜“æ–¼å»ºç«‹èˆ‡ç®¡ç† API ç«¯é»
- Pre-renderingï¼šæ”¯æ´å…©ç¨®å½¢å¼çš„é æ¸²æŸ“ï¼Œåˆ†åˆ¥æ˜¯éœæ…‹ç¶²é ç”Ÿæˆï¼ˆSSGï¼‰å’Œä¼ºæœå™¨æ¸²æŸ“ï¼ˆSSRï¼‰
- Built-in Optimizationsï¼šé‡å°åœ–ç‰‡ã€å­—é«”ã€JavaScript è¼‰å…¥é€²è¡Œè‡ªå‹•å„ªåŒ–ï¼ŒåŒ…æ‹¬å»¶é²è¼‰å…¥èˆ‡ç·©å­˜è™•ç†

ç¶œåˆä¸Šè¿°å„ªé»ï¼ŒNext.js æœ‰åŠ©æ–¼å„ªåŒ–ç¶²é æ•ˆèƒ½èˆ‡ SEOï¼Œé©åˆç”¨æ–¼å»ºç«‹è‘—é™¸é é¢ï¼ˆLanding Pageï¼‰æˆ–æ˜¯ç”¢å“å±•ç¤ºé é¢ï¼Œä½†è¼ƒä¸é©åˆæ‡‰ç”¨åœ¨ç¶“å¸¸è®Šå‹•çš„ç¶²ç«™ï¼Œé¿å…ä¼ºæœå™¨è² è·éå¤§ã€‚

è€Œ Next.js å¯¦éš›ä½¿ç”¨æ¡ˆä¾‹å¯åƒè€ƒ Â [Showcase](https://nextjs.org/showcase)Â  é é¢ï¼Œå¦‚ Notionã€Tik Tok ä»¥åŠ Twitch ç­‰ç¶²ç«™ã€‚

## Next.js Router System è·¯ç”±ç³»çµ±

ç”±æ–¼ Next.js ä½¿ç”¨åŸºæ–¼æª”æ¡ˆç³»çµ±çš„è·¯ç”±ï¼ˆfile-system based routerï¼‰ï¼Œæœƒä¾ç…§å°ˆæ¡ˆçš„æª”æ¡ˆçµæ§‹è‡ªå‹•å®šç¾©è·¯ç”±ã€‚

è€Œæ ¹æ“šç‰ˆæœ¬ä¸åŒï¼ŒNext.js æä¾›å…©ç¨®ç®¡ç†é é¢è·¯ç”±çš„æ–¹å¼ï¼Œåˆ†åˆ¥æ˜¯èˆŠç‰ˆæœ¬é©ç”¨çš„ Pages Router ä»¥åŠ v13 å¾Œæ¨å‡ºçš„ App Routerï¼Œå…©è€…å·®ç•°åœ¨æ–¼ï¼š

- Pages Router

  1. å®šç¾©é é¢å±¤ç´šçš„è·¯ç”±
  2. æ‰€æœ‰å…ƒä»¶ç‚º React Client Componentï¼ˆå®¢æˆ¶ç«¯å…ƒä»¶ï¼‰
  3. åªèƒ½ä½¿ç”¨ Next.js æä¾›çš„é è¨­è¦å‰‡ï¼Œå¦‚ï¼šæª”æ¡ˆåç¨±å³ç‚ºè·¯å¾‘

- App Router
  1. å®šç¾©æ‡‰ç”¨ç¨‹å¼å±¤ç´šçš„è·¯ç”±
  2. æ‰€æœ‰å…ƒä»¶é è¨­ç‚º React Server Componentï¼ˆä¼ºæœå™¨ç«¯å…ƒä»¶ï¼‰
  3. å¯è‡ªå®šç¾©è·¯ç”±è¦å‰‡ï¼Œå¦‚ï¼šä½¿ç”¨æ­£è¦è¡¨é”å¼åŒ¹é…ç‰¹å®šè·¯å¾‘

å¦‚ä¸Šæ‰€è¨€ï¼Œåœ¨ App Router ä¸­æ‰€æœ‰å…ƒä»¶é è¨­ç‚º React Server Componentï¼ˆRSCï¼‰ï¼Œæ„æ€æ˜¯ç”±ä¼ºæœå™¨å°‡ React Component æº–å‚™å¥½ï¼Œå†å‚³çµ¦ Client é¡¯ç¤ºåœ¨ç•«é¢ä¸Šã€‚

è€Œ RSC çš„å„ªç¼ºé»å¦‚ä¸‹ï¼š

- å„ªé»

  1. æ•´åˆå¾Œç«¯æ“ä½œï¼Œå¦‚å­˜å–è³‡æ–™åº«ï¼ˆDBï¼‰ã€è®€å–æª”æ¡ˆï¼ˆFile Systemï¼‰
  2. é™ä½è³‡æ–™é–“çš„ä¾è³´é—œä¿‚ï¼Œæ”¹å–„è«‹æ±‚ç€‘å¸ƒæµï¼ˆWaterfallï¼‰å°è‡´çš„æ•ˆèƒ½å•é¡Œ
  3. é™ä½ JS Bundle Size ä»¥æå‡é é¢æ•ˆèƒ½

- ç¼ºé»
  1. ç„¡æ³•ä½¿ç”¨ React Hooks
  2. ç„¡æ³•ä½¿ç”¨ç€è¦½å™¨ API
  3. ç„¡æ³•æ“ä½œ DOM äº‹ä»¶ç›£è½

é¢å°ä¸Šè¿°ç¼ºé»ï¼ŒNext.js å¯ä¾ç…§ä½¿ç”¨æƒ…å¢ƒä¸åŒï¼Œå°‡å…ƒä»¶å®šç¾©ç‚º Server Component æˆ– Client Componentã€‚èˆ‰ä¾‹ä¾†èªªï¼Œç•¶æŸå€‹å…ƒä»¶éœ€è¦ä½¿ç”¨ Hooks ç®¡ç†æ™‚ï¼Œå¯é€éåœ¨ç¨‹å¼ç¢¼é–‹é ­åŠ ä¸Š 'use client' ä¾†æ¨™ç¤ºå…ƒä»¶é¡å‹ï¼Œè©²å…ƒä»¶åº•ä¸‹çš„å­å…ƒä»¶ä¹Ÿæœƒè‡ªå‹•è¦–ç‚º Client Componentã€‚

ä½†ä¹Ÿå› ç‚ºå¦‚æ­¤ï¼Œç›¸è¼ƒæ–¼ Page Routerï¼Œæ–°ç‰ˆçš„ App Router å­¸ç¿’æ›²ç·šæœƒè¼ƒé«˜ï¼Œéœ€ç­è§£ Server å¦‚ä½•é‹ä½œï¼Œä»¥åŠåˆ¤æ–·å“ªäº›å…ƒä»¶é©åˆæ”¾åœ¨ Server æˆ– Client ç«¯ï¼Œåœ¨ä½¿ç”¨æ™‚é ˆç‰¹åˆ¥æ³¨æ„ã€‚

å¦å¤–ï¼Œ**App Router èˆ‡ Page Router æ˜¯å¯ä»¥ä¸¦å­˜çš„**ï¼Œä½†ä¹Ÿæ˜¯æœ‰ä¸€äº›åŸºæœ¬çš„é™åˆ¶ï¼Œåƒæ˜¯å…©å€‹ç›®éŒ„ä¸èƒ½åŒæ™‚å®šç¾©ä¸€å€‹ routerï¼Œå¦å‰‡æœƒå ±éŒ¯ã€‚å®˜ç¶²æœ‰æä¾›å¦‚ä½•å¾ Page Router migrate App Router çš„[æ•™å­¸æ–‡ç« ](https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration)ï¼Œå¯ä»¥åƒè€ƒå¦‚ä½•è½‰æ›ã€‚

ä»¥ä¸‹ç« ç¯€å°‡æœƒé‡å° App Router èˆ‡ Page Router çš„å·®ç•°é€²è¡Œæ¯”è¼ƒï¼Œä¸¦ä»‹ç´¹ App Router çš„å¹¾å€‹é‡è¦åŠŸèƒ½ã€‚

# å°ˆæ¡ˆå»ºç«‹â€”â€”è³‡æ–™å¤¾çµæ§‹å·®ç•°

## å»ºç«‹ Next.js å°ˆæ¡ˆ

é¦–å…ˆåœ¨çµ‚ç«¯è¼¸å…¥æŒ‡ä»¤ `npx create-next-app` å»ºç«‹ Next.js å°ˆæ¡ˆã€‚

æ¥è‘—æœƒä¾åºå‡ºç¾ä¸‹åˆ—å¹¾å€‹æå•ï¼Œåˆ†åˆ¥å¦‚ä¸‹ï¼š

```
What is your project named? my-app
// å°ˆæ¡ˆåç¨±ï¼Œæ ¼å¼éœ€ç‚ºè‹±æ–‡å°å¯«

Would you like to use TypeScript? No / Yes
// æ˜¯å¦æ”¯æ´ TypeScript

Would you like to use ESLint? No / Yes
// æ˜¯å¦ä½¿ç”¨ ESLintï¼ˆç”¨ä¾†è¦ç¯„ Coding Style çš„å¥—ä»¶ï¼‰

Would you like to use Tailwind CSS? No / Yes
// æ˜¯å¦ä½¿ç”¨ Tailwind CSS

Would you like to use `src/` directory? No / Yes
// æ˜¯å¦åœ¨ /app å¤–åŠ ä¸€å±¤ src è³‡æ–™å¤¾

Would you like to use App Router? (recommended) No / Yes
// æ˜¯å¦ä½¿ç”¨ App Router

Would you like to customize the default import alias (@/*)? No / Yes
// æ˜¯å¦è‡ªè¨‚ alias èª¿æ•´é è¨­çš„ baseURL åŒ¯å…¥è·¯å¾‘

What import alias would you like configured? @/*
// alias é è¨­ä½¿ç”¨ @ æ˜¯å¦ä¿®æ”¹
```

é€™è£¡å…ˆé¸æ“‡ä½¿ç”¨ App Router ï¼Œå»ºç«‹å®Œæˆå¾Œï¼Œåˆå§‹å°ˆæ¡ˆæ¶æ§‹ä¸»è¦åˆ†æˆä»¥ä¸‹ä¸‰å¤§é¡ï¼š

- appï¼šæ”¾ç½® componentsã€pages èˆ‡ api ç­‰æª”æ¡ˆ
  - layout.tsxï¼šåœ¨å¤šå€‹é é¢ä¹‹é–“å®šç¾©å…±ç”¨ UIï¼Œå…¶ç‹€æ…‹å°‡æœƒè¢«ä¿å­˜ï¼Œå¦‚ï¼šnavã€headerã€footer ç­‰å…ƒ
  - page.tsxï¼šåœ¨è³‡æ–™å¤¾åº•ä¸‹éœ€åŒ…å« page.tsx æª”æ¡ˆï¼Œæ‰æœƒè¢«å®šç¾©ç‚ºä¸€å€‹ route segmentï¼Œå¦‚ï¼šapp/blog/page.tsx
  - globals.cssï¼šå®šç¾©å…¨åŸŸæ¨£å¼
- publicï¼šæ”¾ç½®éœæ…‹æª”æ¡ˆï¼Œå¦‚åœ–ç‰‡ç­‰
  - éœ€è¦å¼•å…¥ /public/next.svg æª”æ¡ˆæ™‚ï¼Œè·¯å¾‘å¯ç›´æ¥æŒ‡å‘ /next.svg
- è¨­å®šæª”ï¼šåŒ…å« next.config.jsã€tsconfig.jsonã€package.json ç­‰ç”¨æ–¼è¨­å®šå°ˆæ¡ˆé…ç½®çš„æª”æ¡ˆ

## Page Router è³‡æ–™å¤¾çµæ§‹

```
â””â”€â”€ pages
    â”œâ”€â”€ index.tsx
    â”œâ”€â”€ login.tsx
    â”œâ”€â”€ api
    â”‚   â””â”€â”€ user.tsx
    â”œâ”€â”€ posts
    â”‚   â””â”€â”€ [id].tsx
    â””â”€â”€ blog
        â”œâ”€â”€ index.tsx
        â””â”€â”€ setting.tsx
```

æª”æ¡ˆèˆ‡å°æ‡‰çš„é é¢è·¯ç”±å¦‚ä¸‹ï¼š

- `pages/index.tsx` â†’ `/`
- `pages/blog/index.tsx` â†’ `/blog`
- `pages/blog/setting.tsx` â†’ `/blog/setting`
- `pages/posts/[id].tsx` â†’ `/posts/[id]`
  - æª”åå¯ä½œç‚ºå‹•æ…‹è·¯ç”±çš„åƒæ•¸ï¼Œé€é [useRoute](https://nextjs.org/docs/pages/api-reference/functions/use-router) é€™å€‹ Hook å–å¾— route ç›¸é—œè³‡è¨Š
- å‘¼å« APIï¼š`page/api/user.tsx`

![image](https://github.com/user-attachments/assets/e258e384-5006-4cda-b3f7-bad23eb6aa5d)

ï¼ˆåœ–ç‰‡ä¾†æºï¼š[å®˜æ–¹æ–‡ä»¶](https://nextjs.org/blog/layouts-rfc#how-routing-currently-works)ï¼‰

## App Router è³‡æ–™å¤¾çµæ§‹

```
â””â”€â”€ app
    â”œâ”€â”€ blog
    â”‚   â””â”€â”€ [slug]
    â”‚        â””â”€â”€ page.tsx
    â”œâ”€â”€ login
    â”‚   â””â”€â”€ page.tsx
    â”œâ”€â”€ @analytics
    â”‚   â”œâ”€â”€ page.tsx
    â”‚   â”œâ”€â”€ error.tsx
    â”‚   â””â”€â”€ loading.tsx
    â”œâ”€â”€ api
    â”‚   â””â”€â”€ user
    â”‚       â”œâ”€â”€ index.ts
    â”‚       â””â”€â”€ route.ts
    â”œâ”€â”€ components
    â”‚   â”œâ”€â”€ loading.tsx
    â”‚   â””â”€â”€ button.tsx
    â”œâ”€â”€ globals.css
    â”œâ”€â”€ layout.tsx
    â””â”€â”€ page.tsx
```

æ–‡ä»¶ç›®éŒ„èˆ‡å°æ‡‰çš„é é¢è·¯ç”±å¦‚ä¸‹ï¼š

- `app/page.tsx` â†’ `/`
- `app/login/page.tsx` â†’ `/login`
- `app/blog/[slug]/page.tsx` â†’ `/blog/[slug]`
  - ç›®éŒ„å¯ä½œç‚ºå‹•æ…‹è·¯ç”±çš„åƒæ•¸ï¼Œä¸¦ä»¥ props å‚³å…¥å…ƒä»¶
- å‘¼å« APIï¼š`app/api/user/route.tsx`
- `@` é–‹é ­çš„ folder ä¸æœƒå°è·¯ç”±é€ æˆå½±éŸ¿ï¼š
  - `app/@analytics/page.tsx` å¯¦éš›æ¸²æŸ“çš„è·¯ç”±ç‚º `/`ï¼Œé€™å€‹ç‰¹æ®Šçš„æª”æ¡ˆå¤¾æ˜¯ç”¨ä¾†åˆ‡åˆ†åŒä¸€å€‹è·¯ç”±åº•ä¸‹çš„ä¸åŒé‚è¼¯å€å¡Šã€‚

ä»¥ä¸‹æ˜¯ç›®éŒ„å°æ‡‰é é¢è·¯ç”±çš„ç¤ºæ„åœ– ï¼ˆ[å®˜æ–¹æ–‡ä»¶](https://nextjs.org/docs/app/building-your-application/routing)ï¼‰ï¼š

![image](https://github.com/user-attachments/assets/6918e8a7-398b-456d-ae27-288757d0d2ce)

# Renderingâ€”â€”æ¸²æŸ“çš„å››ç¨®æ–¹å¼ã€è·¯ç”±ç³»çµ±å°å››ç¨®æ¸²æŸ“çš„æ‡‰ç”¨å·®ç•°ã€App Router æ¸²æŸ“æ¦‚å¿µ

## äº†è§£ Next.js ä¸­çš„æ¸²æŸ“æ–¹æ³•ï¼šCSR vs SSR vs SSG vs ISR

### 1. å®¢æˆ¶ç«¯æ¸²æŸ“ (Client-side Rendering, CSR)

**æ¦‚è¿°ï¼š**
å®¢æˆ¶ç«¯æ¸²æŸ“ (CSR) æ˜¯æŒ‡ç€è¦½å™¨ä¸‹è¼‰ä¸€å€‹æœ€å°åŒ–çš„ HTML é é¢å’Œå¿…è¦çš„ JavaScriptï¼Œç„¶å¾Œåœ¨å®¢æˆ¶ç«¯æ¸²æŸ“é é¢ã€‚é é¢æ˜¯åœ¨åˆå§‹ HTML è¼‰å…¥å¾Œåœ¨ç€è¦½å™¨ä¸­å‹•æ…‹æ¸²æŸ“çš„ã€‚

æ­¥é©Ÿå¤§æ¦‚åƒé€™æ¨£ï¼š
Clientï¼ˆç€è¦½å™¨ï¼‰ç¬¬ä¸€æ¬¡ç™¼é€ Request çµ¦ Server => Server å›å‚³åªæœ‰å®¹å™¨ä¸å«å…§å®¹çš„ HTML æª” => å†ç”±ç€è¦½å™¨åŸ·è¡Œ JavaScript å‹•æ…‹ç”¢ç”Ÿè³‡æ–™ => æœ€å¾Œå°‡è³‡æ–™æ¸²æŸ“åˆ°ç•«é¢ä¸Šã€‚ï¼ˆå› æ­¤ç¬¬ä¸€æ¬¡æ¸²æŸ“è¼ƒç‚ºè²»æ™‚ï¼Œè€Œåªæœ‰å®¹å™¨æ²’æœ‰å…§å®¹çš„åŸå§‹ç¢¼ä¹Ÿä¸åˆ©æ–¼ SEOï¼‰

**ä¸»è¦ç‰¹å¾µï¼š**

- **JavaScript é©…å‹•ï¼š** é é¢æ¸²æŸ“ç™¼ç”Ÿåœ¨ç€è¦½å™¨ä¸­ï¼Œé€™æ„å‘³è‘—å…§å®¹æ˜¯ç”± JavaScript å¡«å……çš„ã€‚
- **åˆå§‹è¼‰å…¥å»¶é²ï¼š** é é¢é¡¯ç¤ºå¯èƒ½æœƒæœ‰ä¸€æ®µæ™‚é–“çš„å»¶é²ï¼Œå› ç‚º JavaScript å¿…é ˆå…ˆä¸‹è¼‰ã€è§£æå’ŒåŸ·è¡Œï¼Œæ‰èƒ½é¡¯ç¤ºæ•´å€‹é é¢ã€‚
- **SEO è€ƒé‡ï¼š** CSR å¯èƒ½å° SEO ç”¢ç”Ÿè² é¢å½±éŸ¿ï¼Œå› ç‚ºæŸäº›æœå°‹å¼•æ“å¯èƒ½ä¸æœƒåŸ·è¡Œ JavaScriptï¼Œå°è‡´æˆ‘å€‘ç¶²é å…§å®¹è¢«ç´¢å¼•çš„æ•ˆæœä¸ä½³ã€‚
- **ä½¿ç”¨æ™‚æ©Ÿï¼š** CSR é©ç”¨æ–¼ä¸éœ€è¦è¢«æœå°‹å¼•æ“ç´¢å¼•çš„é é¢ï¼Œæˆ–æ˜¯åœ¨åˆå§‹è¼‰å…¥å¾Œéœ€è¦é«˜äº’å‹•æ€§å’Œé »ç¹æ›´æ–°çš„é é¢ã€‚

### 2. ä¼ºæœå™¨ç«¯æ¸²æŸ“ (Server-side Rendering, SSR)

**æ¦‚è¿°ï¼š**
ä¼ºæœå™¨ç«¯æ¸²æŸ“ (SSR) æ˜¯æŒ‡é é¢çš„ HTML æ˜¯åœ¨æ¯æ¬¡è«‹æ±‚æ™‚ç”±ä¼ºæœå™¨ç”Ÿæˆçš„ã€‚ä¼ºæœå™¨æœƒç²å–æ‰€éœ€çš„è³‡æ–™ï¼Œæ¸²æŸ“é é¢ï¼Œä¸¦å°‡å®Œæ•´æ¸²æŸ“çš„ HTML ç™¼é€çµ¦å®¢æˆ¶ç«¯ã€‚

ä¹Ÿå°±æ˜¯ç•¶ Serverï¼ˆä¼ºæœå™¨ï¼‰åœ¨æ¯æ¬¡æ”¶åˆ° Request æ™‚ï¼Œå°±æœƒå»ºç«‹å¥½å®Œæ•´çš„ HTML å…§å®¹ä¸¦ç™¼é€çµ¦ Clientï¼ˆç€è¦½å™¨ï¼‰ã€‚

**ä¸»è¦ç‰¹å¾µï¼š**

- **å‹•æ…‹æ¸²æŸ“ï¼š** é é¢åœ¨æ¯æ¬¡è«‹æ±‚æ™‚éƒ½æœƒå‹•æ…‹æ¸²æŸ“ï¼Œç¢ºä¿å…§å®¹å§‹çµ‚æ˜¯æœ€æ–°çš„ã€‚
- **SEO å‹å¥½ï¼š** ç”±æ–¼ HTML åœ¨åˆ°é”å®¢æˆ¶ç«¯ä¹‹å‰å·²ç¶“å®Œå…¨æ¸²æŸ“ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«æœå°‹å¼•æ“ç´¢å¼•ã€‚
- **æ•ˆèƒ½è€ƒé‡ï¼š** èˆ‡éœæ…‹æ–¹æ³•ç›¸æ¯”ï¼ŒSSR å¯èƒ½æœƒè¼ƒæ…¢ï¼Œå› ç‚ºä¼ºæœå™¨éœ€è¦åœ¨æ¯æ¬¡è«‹æ±‚æ™‚æ¸²æŸ“é é¢ã€‚

### 3. éœæ…‹ç¶²ç«™ç”Ÿæˆ (Static Site Generation, SSG)

**æ¦‚è¿°ï¼š**
éœæ…‹ç¶²ç«™ç”Ÿæˆ (SSG) æ˜¯æŒ‡é é¢çš„ HTML åœ¨å»ºç½®(build)æ™‚ç”Ÿæˆï¼Œä¸¦å°‡ç›¸åŒçš„ HTML æä¾›çµ¦æ‰€æœ‰ä½¿ç”¨è€…ã€‚å…§å®¹æ˜¯éœæ…‹çš„ï¼Œé€™æ„å‘³è‘—åœ¨ä¸‹ä¸€æ¬¡å»ºç½®ä¹‹å‰ä¸æœƒç™¼ç”Ÿè®ŠåŒ–ã€‚

**ä¸»è¦ç‰¹å¾µï¼š**

- **å»ºç½®æ™‚æ¸²æŸ“ï¼š** é é¢åœ¨å»ºç½®æ™‚é å…ˆæ¸²æŸ“ï¼Œä½¿å…¶åœ¨æä¾›çµ¦ä½¿ç”¨è€…æ™‚é€Ÿåº¦æ¥µå¿«ã€‚
- **SEO å‹å¥½ï¼š** ç”±æ–¼ HTML æ˜¯é å…ˆæ¸²æŸ“çš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«æœå°‹å¼•æ“ç´¢å¼•ã€‚
- **é©ç”¨æ–¼éœæ…‹å…§å®¹ï¼š** SSG é©åˆä¸ç¶“å¸¸è®Šå‹•çš„å…§å®¹ï¼Œä¾‹å¦‚éƒ¨è½æ ¼æ–‡ç« æˆ–è¡ŒéŠ·é é¢ã€‚

### 4. å¢é‡éœæ…‹å†ç”Ÿ (Incremental Static Regeneration, ISR)

**æ¦‚è¿°ï¼š**
å¢é‡éœæ…‹å†ç”Ÿ (ISR)è®“æˆ‘å€‘èƒ½åœ¨å»ºç½®å¾Œæ›´æ–°éœæ…‹é é¢ï¼Œè€Œä¸éœ€è¦å®Œæ•´é‡å»ºã€‚é é¢å¯ä»¥åœ¨æ–°çš„è«‹æ±‚é€²ä¾†æ™‚åœ¨èƒŒæ™¯ä¸­é‡æ–°ç”Ÿæˆï¼Œç¢ºä¿å®ƒå€‘ä¿æŒæœ€æ–°ç‹€æ…‹ï¼ŒåŒæ™‚ä¸çŠ§ç‰²éœæ…‹ç”Ÿæˆçš„æ•ˆèƒ½å„ªå‹¢ã€‚

**ä¸»è¦ç‰¹å¾µï¼š**

- **æ··åˆæ–¹æ³•ï¼š** çµåˆäº† SSG çš„æ•ˆèƒ½å’Œ SSR çš„éˆæ´»æ€§ã€‚
- **è‡ªå‹•æ›´æ–°ï¼š** é é¢æœƒåœ¨æŒ‡å®šçš„æ™‚é–“é–“éš”å¾Œæˆ–æœ‰æ–°è³‡æ–™æ™‚é‡æ–°ç”Ÿæˆã€‚
- **SEO å‹å¥½ï¼š** ç”±æ–¼é é¢æ˜¯éœæ…‹ç”Ÿæˆçš„ï¼Œå› æ­¤å¾ˆå®¹æ˜“è¢«æœå°‹å¼•æ“ç´¢å¼•ã€‚

## Page Router è™•ç† 4 ç¨®æ¸²æŸ“çš„æ–¹å¼

Next.js æä¾›äº†ä¸€å€‹ç¨±ç‚º **Page Router** çš„å¤šåŠŸèƒ½è·¯ç”±ç³»çµ±ï¼Œè®“é–‹ç™¼è€…å¯ä»¥å¯¦ç¾å¤šç¨®æ¸²æŸ“æ–¹æ³•ï¼š**å®¢æˆ¶ç«¯æ¸²æŸ“ (CSR)**ã€**ä¼ºæœå™¨ç«¯æ¸²æŸ“ (SSR)**ã€**éœæ…‹ç¶²ç«™ç”Ÿæˆ (SSG)** å’Œ **å¢é‡éœæ…‹å†ç”Ÿ (ISR)**ã€‚æ¯ç¨®æ–¹æ³•éƒ½æœ‰å…¶ç‰¹å®šçš„ä½¿ç”¨å ´æ™¯å’Œå„ªå‹¢ï¼ŒNext.js æä¾›äº†å¯¦ç¾é€™äº›æ–¹æ³•çš„ç‰¹å®šæ©Ÿåˆ¶ã€‚

### 1. å®¢æˆ¶ç«¯æ¸²æŸ“ (CSR)

- CSR æ˜¯é€éä½¿ç”¨åœ¨é é¢è¼‰å…¥å¾Œåƒ…åœ¨å®¢æˆ¶ç«¯é€²è¡Œè³‡æ–™æŠ“å–çš„ React å…ƒä»¶ä¾†å¯¦ç¾çš„ã€‚
- ç‚ºäº†å¼·åˆ¶ä½¿ç”¨ CSRï¼Œè«‹é¿å…åœ¨é é¢å…ƒä»¶ä¸­ä½¿ç”¨ `getServerSideProps`ã€`getStaticProps` æˆ– `getInitialProps`ã€‚é€™æ¨£é é¢å°±å¯ä»¥éœæ…‹å‚³éï¼Œç„¶å¾Œä»»ä½•å‹•æ…‹è³‡æ–™æŠ“å–åƒ…åœ¨å®¢æˆ¶ç«¯é€²è¡Œã€‚
- åŸ·è¡Œå‡½æ•¸ï¼š`useEffect()` æˆ–ä½¿ç”¨ç”± Next.js åœ˜éšŠé–‹ç™¼çš„ [SWR](https://swr.vercel.app/) é–‹æºå¥—ä»¶

ç¯„ä¾‹ï¼š

```jsx
// pages/csr-page.js
import { useEffect, useState } from "react";

function CSRPage() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch("/api/data")
      .then((res) => res.json())
      .then((data) => setData(data));
  }, []);

  return <div>{data ? JSON.stringify(data) : "Loading..."}</div>;
}

export default CSRPage;
```

### 2. ä¼ºæœå™¨ç«¯æ¸²æŸ“ (SSR)

- SSR æ˜¯é€é `getServerSideProps` å‡½æ•¸ä¾†å¯¦ç¾çš„ï¼Œè©²å‡½æ•¸æœƒåœ¨è«‹æ±‚æ™‚æŠ“å–è³‡æ–™ä¸¦å°‡å…¶ä½œç‚ºå±¬æ€§å‚³éçµ¦é é¢å…ƒä»¶ã€‚
- æ­¤å‡½æ•¸åœ¨æ¯æ¬¡è«‹æ±‚æ™‚éƒ½åœ¨ä¼ºæœå™¨ç«¯åŸ·è¡Œï¼Œç¢ºä¿è³‡æ–™ç¸½æ˜¯æœ€æ–°çš„ã€‚
- åŸ·è¡Œå‡½æ•¸ï¼š`getServerSideProps()`ï¼Œåªæœƒåœ¨ Server side åŸ·è¡Œï¼Œå¯è·³éå‘¼å« API æ­¥é©Ÿç›´æ¥åˆ°è³‡æ–™åº«æŠ“å–è³‡æ–™ã€‚

ç¯„ä¾‹ï¼š

```jsx
// pages/ssr-page.js
export async function getServerSideProps(context) {
  const res = await fetch("<https://api.example.com/data>");
  const data = await res.json();

  return {
    props: { data }, // æœƒä½œç‚ºå±¬æ€§å‚³éçµ¦é é¢å…ƒä»¶
  };
}

function SSRPage({ data }) {
  return <div>{JSON.stringify(data)}</div>;
}

export default SSRPage;
```

### 3. éœæ…‹ç¶²ç«™ç”Ÿæˆ (SSG)

- SSG æ˜¯é€é `getStaticProps` å‡½æ•¸å¯¦ç¾çš„ï¼Œè©²å‡½æ•¸æœƒåœ¨å»ºæ§‹æ™‚æŠ“å–è³‡æ–™ä¸¦å°‡å…¶ä½œç‚ºå±¬æ€§å‚³éçµ¦é é¢å…ƒä»¶ã€‚
- é€™ç¨®æ–¹æ³•æœƒåœ¨å»ºæ§‹æœŸé–“ç‚ºé é¢ç”Ÿæˆéœæ…‹ HTML æ–‡ä»¶ï¼Œæé«˜æ•ˆèƒ½ä¸¦æ¸›å°‘ä¼ºæœå™¨è² è·ã€‚
- ç°¡å–®ä¾†èªªå°±æ˜¯ï¼ŒSSG æœƒåœ¨ç¶²é æ‰“åŒ…ï¼ˆbuilt timeï¼‰æ™‚ï¼Œå°±ç”± Server ç”¢ç”Ÿæ‰€æœ‰éœ€è¦ç”¨åˆ°çš„å…§å®¹ï¼Œå› æ­¤æ¯æ¬¡ Server æ”¶åˆ° Request å‡å›å‚³ç›¸åŒçš„ HTML çµ¦ Clientã€‚
- åŸ·è¡Œå‡½æ•¸ï¼š`getStaticProps()`

ç¯„ä¾‹ï¼š

```jsx
// pages/ssg-page.js
export async function getStaticProps() {
  const res = await fetch("<https://api.example.com/data>");
  const data = await res.json();

  return {
    props: { data }, // æœƒä½œç‚ºå±¬æ€§å‚³éçµ¦é é¢å…ƒä»¶
  };
}

function SSGPage({ data }) {
  return <div>{JSON.stringify(data)}</div>;
}

export default SSGPage;
```

### 4. å¢é‡éœæ…‹å†ç”Ÿ (ISR)

- ISR æ˜¯ SSG çš„æ“´å±•ï¼Œä½¿ç”¨ `getStaticProps` åŠ `revalidate` å±¬æ€§ä¾†å¯¦ç¾ã€‚`revalidate` å±¬æ€§æŒ‡å®šé é¢æ‡‰é‡æ–°é©—è­‰çš„é–“éš”æ™‚é–“ï¼ˆä»¥ç§’ç‚ºå–®ä½ï¼‰ã€‚
- ç•¶ `revalidate` æ™‚é–“éå¾Œæœ‰è«‹æ±‚é€²ä¾†æ™‚ï¼ŒNext.js æœƒåœ¨èƒŒæ™¯ä¸­é‡æ–°ç”Ÿæˆé é¢ã€‚
- ç°¡å–®ä¾†èªªå°±æ˜¯ï¼ŒISR æ˜¯çµåˆ SSG å’Œ SSR çš„æ¸²æŸ“æ–¹å¼ï¼Œå¯è¨­å®šæ¢ä»¶ä¿å­˜ä¸Šä¸€æ¬¡æ¸²æŸ“çµæœï¼Œç•¶éœæ…‹æª”æ¡ˆéæœŸï¼Œå°‡è§¸ç™¼ Server é‡æ–° build HTML æª”æ¡ˆä»¥æ›´æ–°é é¢ã€‚
- åŸ·è¡Œå‡½æ•¸: `getStaticProps()` æ­é… `revalidate` å±¬æ€§

ç¯„ä¾‹ï¼š

```jsx
// pages/isr-page.js
export async function getStaticProps() {
  const res = await fetch("<https://api.example.com/data>");
  const data = await res.json();

  return {
    props: { data },
    revalidate: 10, // ä»¥ç§’ç‚ºå–®ä½ï¼Œé é¢æ¯ 10 ç§’é‡æ–°é©—è­‰ä¸€æ¬¡
  };
}

function ISRPage({ data }) {
  return <div>{JSON.stringify(data)}</div>;
}

export default ISRPage;
```

### Page Router è™•ç† 4 ç¨®æ¸²æŸ“çš„æ–¹å¼ç¸½çµ

- **CSR**ï¼šä½¿ç”¨ React åœ¨å®¢æˆ¶ç«¯é€²è¡Œå…§å®¹æ¸²æŸ“ã€‚ä¸ä½¿ç”¨ç‰¹å®šçš„å‡½æ•¸ï¼ˆ`getStaticProps`ã€`getServerSideProps`ï¼‰ã€‚
- **SSR**ï¼šä½¿ç”¨ `getServerSideProps` åœ¨ä¼ºæœå™¨ä¸Šæ–¼æ¯æ¬¡è«‹æ±‚æ™‚é€²è¡Œå…§å®¹æ¸²æŸ“ã€‚
- **SSG**ï¼šä½¿ç”¨ `getStaticProps` åœ¨å»ºæ§‹æ™‚é€²è¡Œå…§å®¹æ¸²æŸ“ï¼Œç”Ÿæˆéœæ…‹ HTML æ–‡ä»¶ã€‚
- **ISR**ï¼šSSG çš„è®Šé«”ï¼Œä½¿ç”¨ `getStaticProps` å’Œ `revalidate` å±¬æ€§å…è¨±å®šæœŸæ›´æ–°éœæ…‹å…§å®¹ã€‚

## App Router è™•ç† 4 ç¨®æ¸²æŸ“çš„æ–¹å¼

Next.js çš„ App Router å¼•å…¥äº†ä¸€ç¨®æ–°çš„è™•ç†å®¢æˆ¶ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰ã€ä¼ºæœå™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ã€éœæ…‹ç¶²ç«™ç”Ÿæˆï¼ˆSSGï¼‰å’Œå¢é‡éœæ…‹å†ç”Ÿï¼ˆISRï¼‰çš„æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯é€™äº›æ¸²æŸ“æ–¹æ³•çš„å¯¦ä½œæ–¹å¼ï¼š

### 1. å®¢æˆ¶ç«¯æ¸²æŸ“ï¼ˆCSRï¼‰

- åœ¨ App Router ä¸­ï¼ŒCSR çš„è™•ç†æ–¹å¼é¡ä¼¼æ–¼å‚³çµ±çš„ React æ‡‰ç”¨ç¨‹å¼ã€‚å…ƒä»¶åœ¨å®¢æˆ¶ç«¯é€²è¡Œæ¸²æŸ“ï¼Œè³‡æ–™ç²å–å‰‡ä½¿ç”¨ React çš„ hookï¼Œä¾‹å¦‚ `useEffect`ï¼Œæˆ–ä½¿ç”¨åƒ SWR é€™æ¨£çš„åº«ã€‚
- åœ¨ App Router ä¸­è¦é€²è¡Œå®¢æˆ¶ç«¯æ¸²æŸ“çš„è©±ï¼Œéœ€è¦ç‰¹åˆ¥åœ¨å…ƒä»¶çš„é–‹é ­åŠ ä¸Š `'use client'` æŒ‡ä»¤ã€‚

ç¯„ä¾‹ï¼š

```jsx
"use client";

import { useState, useEffect } from "react";

export default function Page() {
  const [data, setData] = useState(null);

  useEffect(() => {
    async function fetchData() {
      const response = await fetch("/api/data");
      const result = await response.json();
      setData(result);
    }
    fetchData();
  }, []);

  return <div>{data ? data : "Loading..."}</div>;
}
```

### 2. ä¼ºæœå™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰

- åœ¨ App Router ä¸­ï¼ŒSSR é€šå¸¸åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­è‡ªå‹•å¯¦ç¾ã€‚ç•¶æˆ‘å€‘å»ºç«‹ä¸€å€‹ä¸ä½¿ç”¨ `'use client'` æŒ‡ä»¤çš„å…ƒä»¶æ™‚ï¼Œå®ƒæœƒè‡ªå‹•åœ¨ä¼ºæœå™¨ä¸Šé€²è¡Œæ¸²æŸ“ã€‚
- å¯ä»¥åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­ç²å–è³‡æ–™ï¼Œä¼ºæœå™¨æœƒåœ¨ç™¼é€ HTML çµ¦å®¢æˆ¶ç«¯ä¹‹å‰å…ˆæ¸²æŸ“å¥½ HTMLã€‚

ç¯„ä¾‹ï¼š

```jsx
export default async function Page() {
  const res = await fetch("<https://api.example.com/data>");
  const data = await res.json();

  return <div>{data}</div>;
}
```

### 3. éœæ…‹ç¶²ç«™ç”Ÿæˆï¼ˆSSGï¼‰

- åœ¨ App Router ä¸­ï¼Œéœæ…‹ç”Ÿæˆæ˜¯é€šéåœ¨å»ºæ§‹æ™‚æ¸²æŸ“ä¼ºæœå™¨å…ƒä»¶ï¼ˆserver componentsï¼‰ä¾†å¯¦ç¾çš„ã€‚
- å¦‚æœå…ƒä»¶åœ¨å»ºæ§‹æ™‚ç²å–è³‡æ–™ä¸¦ä¸”ä¸ä¾è³´æ–¼é‹è¡Œæ™‚è®Šæ•¸ï¼ˆä¾‹å¦‚æŸ¥è©¢åƒæ•¸ï¼‰ï¼Œå‰‡æœƒé€²è¡Œéœæ…‹ç”Ÿæˆã€‚
- è©³ç´°èªªæ˜ï¼š <br />
  åœ¨å‚³çµ±çš„ Next.js ä¸­ï¼Œ`getStaticProps` ç”¨ä¾†åœ¨æ§‹å»ºæ™‚ç²å–è³‡æ–™ä¸¦ç”Ÿæˆéœæ…‹é é¢ã€‚é€™æ˜¯ä¸€ç¨®éœæ…‹ç¶²ç«™ç”Ÿæˆ (SSG) çš„æ–¹æ³•ã€‚ <br />
  è€Œåœ¨ App Router ä¸­ï¼Œéœæ…‹ç”Ÿæˆæ˜¯é€šéä¼ºæœå™¨ç«¯å…ƒä»¶ä¾†å¯¦ç¾çš„ã€‚Next.js æœƒè‡ªå‹•è™•ç†é€™äº›ä¼ºæœå™¨ç«¯å…ƒä»¶çš„é æ¸²æŸ“éç¨‹ï¼Œç¢ºä¿åœ¨æ§‹å»ºæ™‚ç”Ÿæˆéœæ…‹é é¢ã€‚ <br />
  ç¸½è€Œè¨€ä¹‹ï¼Œåœ¨ App Router ä¸­ï¼Œæˆ‘å€‘å·²ä¸å¿…ä½¿ç”¨ `getStaticProps` ä¾†å¯¦ç¾éœæ…‹ç¶²ç«™ç”Ÿæˆï¼Œå› ç‚º Next.js çš„ä¼ºæœå™¨ç«¯å…ƒä»¶å·²ç¶“è™•ç†äº†é€™éƒ¨åˆ†çš„å·¥ä½œã€‚ <br />

ç¯„ä¾‹ï¼š

```jsx
export default async function Page() {
  const res = await fetch("<https://api.example.com/data>");
  const data = await res.json();

  return <div>{data}</div>;
}

// å¦‚æœä¸ä¾è³´æ–¼é‹è¡Œæ™‚è®Šæ•¸ï¼ˆä¾‹å¦‚æŸ¥è©¢åƒæ•¸ï¼‰ï¼ŒNext.js å°‡åœ¨å»ºæ§‹æ™‚éœæ…‹ç”Ÿæˆé€™å€‹é é¢ã€‚
```

### 4. å¢é‡éœæ…‹å†ç”Ÿï¼ˆISRï¼‰

- App Router ä¸­çš„ ISR é€šé `fetch` å‡½æ•¸çš„ `revalidate` é¸é …ä¾†æ”¯æ´ã€‚åœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­ä½¿ç”¨ `fetch` ä¸¦æŒ‡å®š `next: { revalidate: seconds }` é¸é …æ™‚ï¼ŒNext.js æœƒåœ¨æŒ‡å®šçš„ç§’æ•¸å¾Œé‡æ–°ç”Ÿæˆé é¢ã€‚
- é€™å…è¨±é é¢åœ¨ä¸é€²è¡Œå®Œå…¨é‡å»º(rebuild)çš„æƒ…æ³ä¸‹ä¿æŒæœ€æ–°ç‹€æ…‹ã€‚

ç¯„ä¾‹ï¼š

```jsx
export default async function Page() {
  const res = await fetch("<https://api.example.com/data>", { next: { revalidate: 10 } });
  const data = await res.json();

  return <div>{data}</div>;
}

// è©²é é¢å°‡æ¯ 10 ç§’éœæ…‹å†ç”Ÿä¸€æ¬¡ã€‚
```

### App Router è™•ç† 4 ç¨®æ¸²æŸ“çš„æ–¹å¼ç¸½çµ

- **CSR**ï¼šä½¿ç”¨å®¢æˆ¶ç«¯ hookï¼ˆ`useEffect` ç­‰ï¼‰é€²è¡Œç®¡ç†ã€‚
- **SSR**ï¼šåœ¨ä¼ºæœå™¨å…ƒä»¶ä¸­è‡ªå‹•æ‡‰ç”¨ã€‚
- **SSG**ï¼šé€šéä½¿ç”¨æ²’æœ‰é‹è¡Œæ™‚ä¾è³´çš„ä¼ºæœå™¨å…ƒä»¶ä¾†å¯¦ç¾ã€‚ï¼ˆç°¡å–®ä¾†èªªï¼Œå°±æ˜¯å¦‚æœä¼ºæœå™¨å…ƒä»¶åœ¨æ§‹å»ºé é¢æ™‚ä¸éœ€è¦ä¾è³´æ–¼é‹è¡Œæ™‚æ‰æœ‰çš„è³‡æ–™æˆ–æ¢ä»¶ï¼Œé‚£éº¼ Next.js å°±èƒ½å¤ åœ¨æ§‹å»ºéšæ®µç”Ÿæˆé€™å€‹é é¢ï¼Œä¸¦åœ¨é é¢ç™¼ä½ˆå¾Œä¸å†éœ€è¦å‹•æ…‹ç”Ÿæˆã€‚ï¼‰
- **ISR**ï¼šä½¿ç”¨ `fetch` ä¸¦æŒ‡å®š `revalidate` é¸é …ä¾†å¯¦ç¾ã€‚

# Renderingâ€”â€”App Router æ¸²æŸ“æ¦‚å¿µ

é›–ç„¶å‰é¢è¬›è¿° App Router è™•ç† 4 ç¨®æ¸²æŸ“çš„æ–¹å¼ï¼Œä½†åœ¨ App Router åœ¨æ¸²æŸ“çš„æ¦‚å¿µä¸Šï¼Œå·²ç¶“ä¸ç”¨å…ˆå‰çš„ CSRã€SSRã€SSGã€ISR ä¾†èªªæ˜ï¼ˆé‚£ä¸»è¦æ˜¯ Page Router åœ¨ä½¿ç”¨çš„æ¦‚å¿µï¼‰ï¼Œè€Œæ˜¯ä»¥ä¼ºæœå™¨å…ƒä»¶ï¼ˆReact Server Component, RSCï¼‰å’Œå®¢æˆ¶ç«¯å…ƒä»¶ï¼ˆClient Componentï¼‰ä¾†èªªæ˜ã€‚

## 1. ä¼ºæœå™¨å…ƒä»¶ï¼ˆReact Server Component, RSCï¼‰

React ä¼ºæœå™¨å…ƒä»¶è®“æˆ‘å€‘èƒ½æ’°å¯«å¯ä»¥åœ¨ä¼ºæœå™¨ä¸Šæ¸²æŸ“å’Œé¸æ“‡æ€§å¿«å–çš„ UIã€‚åœ¨ Next.js ä¸­ï¼Œæ¸²æŸ“å·¥ä½œé€²ä¸€æ­¥è¢«åˆ†å‰²æˆè·¯ç”±æ®µï¼Œä»¥å¯¦ç¾ä¸²æµå’Œéƒ¨åˆ†æ¸²æŸ“ï¼Œä¸¦ä¸”æœ‰ä¸‰ç¨®ä¸åŒçš„ä¼ºæœå™¨æ¸²æŸ“ç­–ç•¥ï¼š

- [éœæ…‹æ¸²æŸ“](https://nextjs.org/docs/app/building-your-application/rendering/server-components#static-rendering-default)
- [å‹•æ…‹æ¸²æŸ“](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-rendering)
- [ä¸²æµ](https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming)

### ä¼ºæœå™¨æ¸²æŸ“çš„å„ªå‹¢

åœ¨ä¼ºæœå™¨ä¸Šé€²è¡Œæ¸²æŸ“æœ‰å¹¾å€‹å„ªå‹¢ï¼ŒåŒ…æ‹¬ï¼š

- **è³‡æ–™ç²å–**ï¼šä¼ºæœå™¨å…ƒä»¶è®“æˆ‘å€‘å¯å°‡è³‡æ–™ç²å–ç§»åˆ°ä¼ºæœå™¨ï¼Œæ›´æ¥è¿‘è³‡æ–™ä¾†æºã€‚é€™å¯ä»¥é€šéæ¸›å°‘ç²å–æ¸²æŸ“æ‰€éœ€è³‡æ–™çš„æ™‚é–“ä»¥åŠå®¢æˆ¶ç«¯æ‰€éœ€ç™¼é€çš„è«‹æ±‚æ•¸é‡ä¾†æé«˜æ•ˆèƒ½ã€‚
- **å®‰å…¨æ€§**ï¼šä¼ºæœå™¨å…ƒä»¶è®“æˆ‘å€‘å¯å°‡æ•æ„Ÿè³‡æ–™å’Œé‚è¼¯ä¿ç•™åœ¨ä¼ºæœå™¨ä¸Šï¼Œä¾‹å¦‚ä»¤ç‰Œå’Œ API å¯†é‘°ï¼Œé¿å…å°‡å…¶æš´éœ²çµ¦å®¢æˆ¶ç«¯ã€‚
- **å¿«å–**ï¼šé€éåœ¨ä¼ºæœå™¨ä¸Šé€²è¡Œæ¸²æŸ“ï¼Œçµæœå¯ä»¥è¢«å¿«å–ä¸¦åœ¨å¾ŒçºŒè«‹æ±‚å’Œä¸åŒä½¿ç”¨è€…ä¹‹é–“é‡è¤‡ä½¿ç”¨ã€‚é€™å¯ä»¥æé«˜æ•ˆèƒ½ä¸¦æ¸›å°‘æˆæœ¬ï¼Œå› ç‚ºæ¯æ¬¡è«‹æ±‚æ™‚æ‰€éœ€çš„æ¸²æŸ“å’Œè³‡æ–™ç²å–é‡æ¸›å°‘ã€‚
- **æ•ˆèƒ½**ï¼šä¼ºæœå™¨å…ƒä»¶æä¾›äº†é¡å¤–çš„å·¥å…·ä¾†å„ªåŒ–æ•ˆèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å€‘å¾å®Œå…¨ç”±å®¢æˆ¶ç«¯å…ƒä»¶çµ„æˆçš„æ‡‰ç”¨é–‹å§‹ï¼Œå°‡éäº’å‹•æ€§çš„ UI éƒ¨åˆ†ç§»åˆ°ä¼ºæœå™¨å…ƒä»¶å¯ä»¥æ¸›å°‘æ‰€éœ€çš„å®¢æˆ¶ç«¯ JavaScriptã€‚é€™å°æ–¼ç¶²é€Ÿè¼ƒæ…¢æˆ–è¨­å‚™è¼ƒä¸å¼·çš„ä½¿ç”¨è€…ç‰¹åˆ¥æœ‰åˆ©ï¼Œå› ç‚ºç€è¦½å™¨éœ€è¦ä¸‹è¼‰ã€è§£æå’ŒåŸ·è¡Œçš„å®¢æˆ¶ç«¯ JavaScript æ¸›å°‘äº†ã€‚
- **åˆæ¬¡é é¢è¼‰å…¥å’Œ [é¦–æ¬¡å…§å®¹ç¹ªè£½ (FCP)](https://web.dev/fcp/)**ï¼šå¯ä»¥ç”Ÿæˆ HTML è®“ä½¿ç”¨è€…ç«‹å³æŸ¥çœ‹é é¢ï¼Œè€Œç„¡éœ€ç­‰å¾…å®¢æˆ¶ç«¯ä¸‹è¼‰ã€è§£æå’ŒåŸ·è¡Œæ¸²æŸ“é é¢æ‰€éœ€çš„ JavaScriptã€‚
- **æœå°‹å¼•æ“å„ªåŒ–å’Œç¤¾ç¾¤ç¶²è·¯åˆ†äº«**ï¼šæ¸²æŸ“çš„ HTML å¯ä»¥è¢«æœå°‹å¼•æ“æ©Ÿå™¨äººç”¨ä¾†ç´¢å¼•é é¢å…§å®¹ï¼Œä»¥åŠè¢«ç¤¾ç¾¤ç¶²è·¯æ©Ÿå™¨äººç”¨ä¾†ç”Ÿæˆç¤¾äº¤å¡ç‰‡é è¦½ã€‚
- **ä¸²æµ**ï¼šä¼ºæœå™¨å…ƒä»¶å°‡æ¸²æŸ“å·¥ä½œæ‹†åˆ†æˆå¤šå€‹å€å¡Šï¼Œç•¶å€å¡Šæº–å‚™å°±ç·’æ™‚å†é€æ­¥å°‡å®ƒå€‘ä¸²æµå‚³è¼¸åˆ°å®¢æˆ¶ç«¯ã€‚ä¹Ÿå°±æ˜¯åœ¨æ•´å€‹é é¢æ¸²æŸ“å®Œæˆä¹‹å‰ï¼Œå°±å…ˆæä¾›éƒ¨åˆ†å…§å®¹çµ¦ä½¿ç”¨è€…ï¼Œé€™æ¨£å¯ä»¥æå‡ä½¿ç”¨è€…é«”é©—ã€‚

### åœ¨ Next.js ä¸­ä½¿ç”¨ä¼ºæœå™¨å…ƒä»¶

Next.js é è¨­å°±æ˜¯ä½¿ç”¨ä¼ºæœå™¨å…ƒä»¶ï¼Œè‡ªå‹•å¯¦ç¾ä¼ºæœå™¨æ¸²æŸ“ï¼Œä¸éœ€è¦å¦å¤–è¨­å®šã€‚

### ä¼ºæœå™¨å…ƒä»¶å¦‚ä½•æ¸²æŸ“ï¼Ÿ

åœ¨ä¼ºæœå™¨ä¸Šï¼ŒNext.js ä½¿ç”¨ React çš„ API ä¾†å”èª¿æ¸²æŸ“ã€‚æ¸²æŸ“å·¥ä½œè¢«åˆ†å‰²æˆå€å¡Šï¼šä¾ç…§å–®ç¨çš„è·¯ç”±æ®µ(individual route segments)å’Œ [Suspense Boundaries](https://react.dev/reference/react/Suspense) ä¾†åˆ†å‰²ã€‚

æ¯å€‹å€å¡Šçš„æ¸²æŸ“åˆ†ç‚ºå…©å€‹æ­¥é©Ÿï¼š

1. React å°‡ä¼ºæœå™¨å…ƒä»¶æ¸²æŸ“ç‚ºä¸€ç¨®ç¨±ç‚º **React Server Component Payload (RSC Payload)** çš„ç‰¹æ®Šè³‡æ–™æ ¼å¼ã€‚
2. Next.js ä½¿ç”¨ RSC Payload å’Œå®¢æˆ¶ç«¯å…ƒä»¶ JavaScript æŒ‡ä»¤åœ¨ä¼ºæœå™¨ä¸Šæ¸²æŸ“ **HTML**ã€‚

ç„¶å¾Œï¼Œåœ¨å®¢æˆ¶ç«¯ï¼š

1. HTML ç”¨æ–¼ç«‹å³é¡¯ç¤ºè·¯ç”±çš„å¿«é€Ÿéäº’å‹•é è¦½â€”â€”é€™åƒ…é™æ–¼åˆæ¬¡é é¢è¼‰å…¥ã€‚
2. RSC Payload ç”¨æ–¼èª¿å’Œå®¢æˆ¶ç«¯å’Œä¼ºæœå™¨å…ƒä»¶æ¨¹ï¼Œä¸¦æ›´æ–° DOMã€‚
3. JavaScript æŒ‡ä»¤ç”¨æ–¼ [hydrate](https://react.dev/reference/react-dom/client/hydrateRoot) å®¢æˆ¶ç«¯å…ƒä»¶ï¼Œä¸¦ä½¿æ‡‰ç”¨ç¨‹å¼å…·å‚™äº’å‹•æ€§ã€‚

> ä»€éº¼æ˜¯ RSC Payloadï¼Ÿ
>
> RSC Payload æ˜¯æ¸²æŸ“çš„ React ä¼ºæœå™¨å…ƒä»¶æ¨¹çš„ç·Šæ¹ŠäºŒé€²ä½è¡¨ç¤ºã€‚React åœ¨å®¢æˆ¶ç«¯ä½¿ç”¨å®ƒä¾†æ›´æ–°ç€è¦½å™¨çš„ DOMã€‚
>
> RSC Payload åŒ…å«ï¼š
>
> - ä¼ºæœå™¨å…ƒä»¶çš„æ¸²æŸ“çµæœ
> - å®¢æˆ¶ç«¯å…ƒä»¶æ‡‰æ¸²æŸ“çš„ä½ç½®ä½”ä½ç¬¦ä»¥åŠå°å…¶ JavaScript æª”æ¡ˆçš„å¼•ç”¨
> - å¾ä¼ºæœå™¨å…ƒä»¶å‚³éçµ¦å®¢æˆ¶ç«¯å…ƒä»¶çš„ä»»ä½• props

### ä¼ºæœå™¨æ¸²æŸ“ç­–ç•¥

ä¼ºæœå™¨æ¸²æŸ“æœ‰ä¸‰å€‹å­é›†ï¼šéœæ…‹ã€å‹•æ…‹å’Œä¸²æµã€‚

#### 1. éœæ…‹æ¸²æŸ“ï¼ˆé è¨­ï¼‰

éœæ…‹æ¸²æŸ“æ˜¯æŒ‡åœ¨ **æ§‹å»ºæ™‚** æˆ–åœ¨ [è³‡æ–™é‡æ–°é©—è­‰](https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration) ä¹‹å¾Œçš„èƒŒæ™¯ä¸­é€²è¡Œè·¯ç”±æ¸²æŸ“ã€‚çµæœæœƒè¢«å¿«å–ä¸¦æ¨é€åˆ° [å…§å®¹å‚³éç¶²è·¯ (CDN)](https://developer.mozilla.org/docs/Glossary/CDN)ã€‚é€™ç¨®å„ªåŒ–è®“æˆ‘å€‘å¯ä»¥åœ¨ä½¿ç”¨è€…å’Œä¼ºæœå™¨è«‹æ±‚ä¹‹é–“å…±äº«æ¸²æŸ“å·¥ä½œçš„çµæœã€‚

éœæ…‹æ¸²æŸ“é©ç”¨æ–¼å…·æœ‰éå€‹äººåŒ–è³‡æ–™çš„è·¯ç”±ï¼Œé€™äº›è³‡æ–™åœ¨æ§‹å»ºæ™‚å¯ä»¥çŸ¥é“ï¼Œä¾‹å¦‚éœæ…‹éƒ¨è½æ ¼æ–‡ç« æˆ–ç”¢å“é é¢ã€‚

#### 2. å‹•æ…‹æ¸²æŸ“

å‹•æ…‹æ¸²æŸ“æ˜¯æŒ‡åœ¨ **è«‹æ±‚æ™‚** ç‚ºæ¯å€‹ä½¿ç”¨è€…æ¸²æŸ“è·¯ç”±ã€‚

å‹•æ…‹æ¸²æŸ“é©ç”¨æ–¼å…·æœ‰å€‹äººåŒ–è³‡æ–™çš„è·¯ç”±ï¼Œæˆ–è€…å…·æœ‰åƒ…åœ¨è«‹æ±‚æ™‚æ‰èƒ½çŸ¥é“çš„è³‡è¨Šï¼Œä¾‹å¦‚ cookies æˆ– URL çš„æœå°‹åƒæ•¸ã€‚

> ä½¿ç”¨å¿«å–è³‡æ–™çš„å‹•æ…‹è·¯ç”±
>
> å¤§å¤šæ•¸ç¶²ç«™çš„è·¯ç”±æ—¢ä¸æ˜¯å®Œå…¨éœæ…‹çš„ä¹Ÿä¸æ˜¯å®Œå…¨å‹•æ…‹çš„â€”â€”å®ƒå€‘æ˜¯è™•æ–¼ä¸€å€‹å…‰è­œä¸­ã€‚ä¾‹å¦‚ï¼Œä¸€å€‹é›»å­å•†å‹™é é¢ï¼Œä½¿ç”¨å¿«å–çš„ç”¢å“è³‡æ–™ä¸¦å®šæœŸé‡æ–°é©—è­‰ï¼Œä½†åŒæ™‚ä¹Ÿå…·æœ‰æœªå¿«å–çš„å€‹äººåŒ–å®¢æˆ¶è³‡æ–™ã€‚
>
> åœ¨ Next.js ä¸­ï¼Œæˆ‘å€‘å¯ä»¥å‹•æ…‹æ¸²æŸ“åŒ…å«å¿«å–å’Œæœªå¿«å–è³‡æ–™çš„è·¯ç”±ã€‚é€™æ˜¯å› ç‚º RSC Payload å’Œè³‡æ–™æ˜¯åˆ†é–‹å¿«å–çš„ã€‚é€™è®“æˆ‘å€‘å¯ä»¥é¸æ“‡å‹•æ…‹æ¸²æŸ“ï¼Œä¸¦ä¸”ä¸ç”¨æ“”å¿ƒåœ¨è«‹æ±‚æ™‚ç²å–æ‰€æœ‰è³‡æ–™å°æ•ˆèƒ½çš„å½±éŸ¿ã€‚
>
> äº†è§£æ›´å¤šé—œæ–¼ [å®Œæ•´è·¯ç”±å¿«å–](https://nextjs.org/docs/app/building-your-application/caching#full-route-cache) å’Œ [è³‡æ–™å¿«å–](https://nextjs.org/docs/app/building-your-application/caching#data-cache) çš„è³‡è¨Šã€‚

ï¼ˆğŸŒ° çš„æ›¸ç±¤ï¼‰

åˆ‡æ›åˆ°å‹•æ…‹æ¸²æŸ“ï¼š

åœ¨æ¸²æŸ“éç¨‹ä¸­ï¼Œå¦‚æœç™¼ç¾ [å‹•æ…‹å‡½æ•¸](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-functions) æˆ–æœªå¿«å–è³‡æ–™è«‹æ±‚ï¼ŒNext.js å°‡åˆ‡æ›åˆ°å‹•æ…‹æ¸²æŸ“æ•´å€‹è·¯ç”±ã€‚ä¸‹è¡¨ç¸½çµäº†å‹•æ…‹å‡½æ•¸å’Œè³‡æ–™å¿«å–å¦‚ä½•å½±éŸ¿è·¯ç”±æ˜¯éœæ…‹é‚„æ˜¯å‹•æ…‹æ¸²æŸ“ï¼š

| å‹•æ…‹å‡½æ•¸ | è³‡æ–™   | è·¯ç”±     |
| -------- | ------ | -------- |
| å¦       | å¿«å–   | éœæ…‹æ¸²æŸ“ |
| æ˜¯       | å¿«å–   | å‹•æ…‹æ¸²æŸ“ |
| å¦       | æœªå¿«å– | å‹•æ…‹æ¸²æŸ“ |
| æ˜¯       | æœªå¿«å– | å‹•æ…‹æ¸²æŸ“ |

åœ¨ä¸Šè¡¨ä¸­ï¼Œè‹¥è¦ä½¿è·¯ç”±å®Œå…¨éœæ…‹ï¼Œæ‰€æœ‰è³‡æ–™å¿…é ˆè¢«å¿«å–ã€‚ç„¶è€Œï¼Œæˆ‘å€‘å¯ä»¥æ“æœ‰ä¸€å€‹å‹•æ…‹æ¸²æŸ“çš„è·¯ç”±ï¼Œè©²è·¯ç”±ä½¿ç”¨å¿«å–å’Œæœªå¿«å–çš„è³‡æ–™ç²å–ã€‚

ä½œç‚ºé–‹ç™¼è€…ï¼Œæˆ‘å€‘ä¸éœ€è¦åœ¨éœæ…‹å’Œå‹•æ…‹æ¸²æŸ“ä¹‹é–“é€²è¡Œé¸æ“‡ï¼Œå› ç‚º Next.js å°‡æ ¹æ“šæ‰€ä½¿ç”¨çš„åŠŸèƒ½å’Œ API è‡ªå‹•é¸æ“‡æ¯å€‹è·¯ç”±çš„æœ€ä½³æ¸²æŸ“ç­–ç•¥ã€‚æˆ‘å€‘å¯ä»¥é¸æ“‡ä½•æ™‚ [å¿«å–](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching) æˆ– [é‡æ–°é©—è­‰ç‰¹å®šè³‡æ–™](https://nextjs.org/docs/app/building-your-application/data-fetching/incremental-static-regeneration)ï¼Œä¸¦ä¸”æˆ‘å€‘å¯ä»¥é¸æ“‡ [ä¸²æµ](https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming) UI çš„éƒ¨åˆ†å…§å®¹ã€‚

å‹•æ…‹å‡½æ•¸ï¼š

å‹•æ…‹å‡½æ•¸ä¾è³´æ–¼åƒ…åœ¨è«‹æ±‚æ™‚æ‰èƒ½çŸ¥é“çš„è³‡è¨Šï¼Œä¾‹å¦‚ä½¿ç”¨è€…çš„ cookiesã€ç•¶å‰è«‹æ±‚çš„æ¨™é ­æˆ– URL çš„æœå°‹åƒæ•¸ã€‚åœ¨ Next.js ä¸­ï¼Œé€™äº›å‹•æ…‹ API åŒ…æ‹¬ï¼š

- [`cookies()`](https://nextjs.org/docs/app/api-reference/functions/cookies)
- [`headers()`](https://nextjs.org/docs/app/api-reference/functions/headers)
- [`unstable_noStore()`](https://nextjs.org/docs/app/api-reference/functions/unstable_noStore)
- [`unstable_after()`](https://nextjs.org/docs/app/api-reference/functions/unstable_after)
- [`searchParams` prop](https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional)

ä½¿ç”¨ä»»ä½•é€™äº›å‡½æ•¸å°‡ä½¿æ•´å€‹è·¯ç”±åœ¨è«‹æ±‚æ™‚é€²å…¥å‹•æ…‹æ¸²æŸ“æ¨¡å¼ã€‚

#### 3. ä¸²æµ

_ï¼ˆåœ–ä¸€ï¼‰_

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/d06fa267-5063-4931-8ade-fa45a882a2e2/76845164-0ccf-4c15-8071-7b470c2d4f94/image.png)

ä¸²æµä½¿æˆ‘å€‘å¯ä»¥é€æ­¥å¾ä¼ºæœå™¨æ¸²æŸ“ UIã€‚å·¥ä½œè¢«æ‹†åˆ†æˆå¤šå€‹å€å¡Šï¼Œä¸¦åœ¨æº–å‚™å¥½æ™‚é€æ­¥ä¸²æµåˆ°å®¢æˆ¶ç«¯ã€‚é€™ä½¿å¾—ä½¿ç”¨è€…å¯ä»¥åœ¨æ•´å€‹å…§å®¹æ¸²æŸ“å®Œæˆä¹‹å‰ç«‹å³çœ‹åˆ°éƒ¨åˆ†é é¢å…§å®¹ã€‚

_ï¼ˆåœ–äºŒï¼‰_

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/d06fa267-5063-4931-8ade-fa45a882a2e2/486d153f-d0b5-40ae-a4d2-75530f1ab35b/image.png)

ä¸²æµæ˜¯ Next.js App Router çš„å…§å»ºåŠŸèƒ½ã€‚é€™æœ‰åŠ©æ–¼æé«˜åˆæ¬¡é é¢è¼‰å…¥æ•ˆèƒ½ï¼Œä»¥åŠä¾è³´è¼ƒæ…¢è³‡æ–™ç²å–çš„ UIï¼Œé€™äº›è³‡æ–™æœƒé˜»å¡æ•´å€‹è·¯ç”±çš„æ¸²æŸ“ã€‚ä¾‹å¦‚ï¼Œç”¢å“é é¢ä¸Šçš„è©•è«–ã€‚

æˆ‘å€‘å¯ä»¥ä½¿ç”¨ `loading.js` å’Œ [React Suspense](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming) é–‹å§‹ä¸²æµè·¯ç”±æ®µå’Œ UI å…ƒä»¶ã€‚è«‹åƒè¦‹ [Loading UI å’Œä¸²æµ](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming) éƒ¨åˆ†ä»¥ç²å–æ›´å¤šè³‡è¨Šã€‚

## 2. å®¢æˆ¶ç«¯å…ƒä»¶ï¼ˆClient Componentï¼‰

å®¢æˆ¶ç«¯å…ƒä»¶è®“æˆ‘å€‘å¯ä»¥æ’°å¯«å¯äº’å‹•çš„ä½¿ç”¨è€…ä»‹é¢ï¼Œé€™äº›ä»‹é¢æ˜¯[åœ¨ä¼ºæœå™¨ä¸Šé å…ˆæ¸²æŸ“](https://github.com/reactwg/server-components/discussions/4)çš„ï¼Œä¸¦ä¸”å¯ä»¥ä½¿ç”¨å®¢æˆ¶ç«¯çš„ JavaScript åœ¨ç€è¦½å™¨ä¸­åŸ·è¡Œã€‚

### å®¢æˆ¶ç«¯æ¸²æŸ“çš„å¥½è™•

åœ¨å®¢æˆ¶ç«¯åŸ·è¡Œæ¸²æŸ“æœ‰å¹¾å€‹å¥½è™•ï¼ŒåŒ…æ‹¬ï¼š

- **äº’å‹•æ€§**ï¼šå®¢æˆ¶ç«¯å…ƒä»¶å¯ä»¥ä½¿ç”¨ç‹€æ…‹(state)ã€æ•ˆæœ(effects)å’Œäº‹ä»¶ç›£è½å™¨(event listeners)ï¼Œé€™æ„å‘³è‘—å®ƒå€‘å¯ä»¥çµ¦ä½¿ç”¨è€…å³æ™‚çš„å›é¥‹ï¼Œä¸¦æ›´æ–°ä½¿ç”¨è€…ä»‹é¢ã€‚
- **ç€è¦½å™¨ API**ï¼šå®¢æˆ¶ç«¯å…ƒä»¶å¯ä»¥è¨ªå•ç€è¦½å™¨ APIï¼Œä¾‹å¦‚[åœ°ç†ä½ç½®](https://developer.mozilla.org/docs/Web/API/Geolocation_API)æˆ–[æœ¬åœ°å„²å­˜](https://developer.mozilla.org/docs/Web/API/Window/localStorage)ã€‚

### åœ¨ Next.js ä¸­ä½¿ç”¨å®¢æˆ¶ç«¯å…ƒä»¶

è¦ä½¿ç”¨å®¢æˆ¶ç«¯å…ƒä»¶ï¼Œéœ€è¦åœ¨æª”æ¡ˆé ‚éƒ¨å¼•å…¥ React çš„[`"use client"`æŒ‡ä»¤](https://react.dev/reference/react/use-client)ï¼Œæ”¾åœ¨æ‰€æœ‰åŒ¯å…¥èªå¥ä¹‹å‰ã€‚

`"use client"` ç”¨æ–¼åœ¨ä¼ºæœå™¨ç«¯å…ƒä»¶å’Œå®¢æˆ¶ç«¯å…ƒä»¶ä¹‹é–“å»ºç«‹[ç•Œé™](https://nextjs.org/docs/app/building-your-application/rendering#network-boundary)ã€‚é€™æ„å‘³è‘—åœ¨æª”æ¡ˆä¸­å®šç¾© `"use client"` å¾Œï¼Œæ‰€æœ‰åŒ¯å…¥å…¶ä¸­çš„å…¶ä»–æ¨¡çµ„ï¼ŒåŒ…æ‹¬å­å…ƒä»¶ï¼Œéƒ½æœƒè¢«è¦–ç‚ºå®¢æˆ¶ç«¯åŒ…çš„ä¸€éƒ¨åˆ†ã€‚

app/counter.tsx

```jsx
"use client";

import { useState } from "react";

export default function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  );
}
```

ä¸‹åœ–é¡¯ç¤ºï¼Œå¦‚æœæœªå®šç¾© `"use client"` æŒ‡ä»¤ï¼Œåœ¨å·¢ç‹€å…ƒä»¶ (`toggle.js`) ä¸­ä½¿ç”¨ `onClick` å’Œ `useState` å°‡æœƒå°è‡´éŒ¯èª¤ã€‚é€™æ˜¯å› ç‚ºé è¨­æƒ…æ³ä¸‹ï¼Œæ‡‰ç”¨ç¨‹å¼è·¯ç”±ä¸­çš„æ‰€æœ‰å…ƒä»¶éƒ½æ˜¯ä¼ºæœå™¨å…ƒä»¶ï¼Œé€™äº› API ç„¡æ³•ä½¿ç”¨ã€‚é€šéåœ¨ `toggle.js` ä¸­å®šç¾© `"use client"` æŒ‡ä»¤ï¼Œå¯ä»¥å‘Šè¨´ React é€²å…¥å®¢æˆ¶ç«¯é‚Šç•Œï¼Œé€™äº› API åœ¨æ­¤å¯ç”¨ã€‚

![image](https://github.com/user-attachments/assets/328123ef-503e-45bb-b9c8-35d583a49c5a)

> è£œå……ï¼šå®šç¾©å¤šå€‹ use client å…¥å£é»
>
> æˆ‘å€‘å¯ä»¥åœ¨ React å…ƒä»¶æ¨¹ä¸­å®šç¾©å¤šå€‹ `"use client"` å…¥å£é»ã€‚é€™æ¨£å°±å¯å°‡æ‡‰ç”¨ç¨‹å¼åˆ†å‰²ç‚ºå¤šå€‹å®¢æˆ¶ç«¯åŒ…(client bundles)ã€‚
>
> ä½†æ˜¯ï¼Œ`"use client"` ä¸¦ä¸éœ€è¦åœ¨æ¯å€‹éœ€è¦åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“çš„å…ƒä»¶ä¸­å®šç¾©ã€‚åªè¦å®šç¾©äº†é‚Šç•Œï¼Œæ‰€æœ‰å­å…ƒä»¶å’ŒåŒ¯å…¥å…¶ä¸­çš„æ¨¡çµ„éƒ½æœƒè¢«è¦–ç‚ºå®¢æˆ¶ç«¯åŒ…çš„ä¸€éƒ¨åˆ†ã€‚

### å®¢æˆ¶ç«¯å…ƒä»¶å¦‚ä½•è¢«æ¸²æŸ“ï¼Ÿ

åœ¨ Next.js ä¸­ï¼Œå®¢æˆ¶ç«¯å…ƒä»¶çš„æ¸²æŸ“æ–¹å¼å–æ±ºæ–¼è«‹æ±‚æ˜¯å±¬æ–¼**æ•´é è¼‰å…¥**ï¼ˆä¾‹å¦‚é¦–æ¬¡è¨ªå•æ‡‰ç”¨ç¨‹å¼æˆ–ç”±ç€è¦½å™¨é‡æ–°æ•´ç†è§¸ç™¼çš„é é¢è¼‰å…¥ï¼‰æˆ–è€…æ˜¯**å¾ŒçºŒçš„å°èˆª**ã€‚

#### æ•´é è¼‰å…¥ï¼ˆFull page loadï¼‰:

ç‚ºäº†å„ªåŒ–åˆæ¬¡é é¢è¼‰å…¥ï¼ŒNext.js å°‡ä½¿ç”¨ React çš„ API åœ¨ä¼ºæœå™¨ä¸Šç‚ºå®¢æˆ¶ç«¯å…ƒä»¶å’Œä¼ºæœå™¨å…ƒä»¶æ¸²æŸ“éœæ…‹ HTML é è¦½ã€‚é€™æ„å‘³è‘—ï¼Œç•¶ä½¿ç”¨è€…é¦–æ¬¡è¨ªå•æˆ‘å€‘çš„æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œä»–å€‘å°‡ç«‹å³çœ‹åˆ°é é¢çš„å…§å®¹ï¼Œè€Œç„¡éœ€ç­‰å¾…å®¢æˆ¶ç«¯ä¸‹è¼‰ã€è§£æå’ŒåŸ·è¡Œå®¢æˆ¶ç«¯å…ƒä»¶çš„ JavaScript åŒ…ã€‚

åœ¨ä¼ºæœå™¨ä¸Šï¼š

1. React å°‡ä¼ºæœå™¨å…ƒä»¶æ¸²æŸ“ç‚ºä¸€ç¨®ç¨±ç‚º [**React ä¼ºæœå™¨å…ƒä»¶æœ‰æ•ˆè² è¼‰ (RSC Payload)**](https://nextjs.org/docs/app/building-your-application/rendering/server-components#what-is-the-react-server-component-payload-rsc) çš„ç‰¹æ®Šè³‡æ–™æ ¼å¼ï¼Œå…¶ä¸­åŒ…å«å°å®¢æˆ¶ç«¯å…ƒä»¶çš„å¼•ç”¨ã€‚
2. Next.js ä½¿ç”¨ RSC è² è¼‰å’Œå®¢æˆ¶ç«¯å…ƒä»¶çš„ JavaScript æŒ‡ä»¤ï¼Œåœ¨ä¼ºæœå™¨ä¸Šæ¸²æŸ“è·¯å¾‘çš„ **HTML**ã€‚

æ¥è‘—ï¼Œåœ¨å®¢æˆ¶ç«¯ï¼š

1. ä½¿ç”¨ HTML ç«‹å³é¡¯ç¤ºå¿«é€Ÿä½†ä¸å¯äº’å‹•çš„åˆå§‹é è¦½ã€‚
2. ä½¿ç”¨ React ä¼ºæœå™¨å…ƒä»¶è² è¼‰ä¾†èª¿å’Œå®¢æˆ¶ç«¯å…ƒä»¶å’Œä¼ºæœå™¨å…ƒä»¶æ¨¹ï¼Œä¸¦æ›´æ–° DOMã€‚
3. ä½¿ç”¨ JavaScript æŒ‡ä»¤ä¾† [hydrate](https://react.dev/reference/react-dom/client/hydrateRoot) å®¢æˆ¶ç«¯å…ƒä»¶ï¼Œè®“å®ƒå€‘çš„ä½¿ç”¨è€…ä»‹é¢å¯äº’å‹•ã€‚

> è£œå……ï¼šä»€éº¼æ˜¯ Hydrationï¼Ÿ
>
> Hydration æ˜¯å°‡äº‹ä»¶ç›£è½å™¨é™„åŠ åˆ° DOM çš„éç¨‹ï¼Œä½¿éœæ…‹ HTML è®Šå¾—å¯äº’å‹•ã€‚Hydration çš„èƒŒå¾Œæ˜¯ä½¿ç”¨ [`hydrateRoot`](https://react.dev/reference/react-dom/client/hydrateRoot) React API å®Œæˆçš„ã€‚

#### å¾ŒçºŒå°èˆªï¼ˆSubsequent Navigationsï¼‰:

åœ¨å¾ŒçºŒå°èˆªä¸­ï¼Œå®¢æˆ¶ç«¯å…ƒä»¶å®Œå…¨åœ¨å®¢æˆ¶ç«¯æ¸²æŸ“ï¼Œç„¡éœ€ä¼ºæœå™¨æ¸²æŸ“çš„ HTMLã€‚

é€™æ„å‘³è‘—å®¢æˆ¶ç«¯å…ƒä»¶çš„ JavaScript åŒ…å°‡è¢«ä¸‹è¼‰ä¸¦è§£æã€‚ä¸€æ—¦åŒ…æº–å‚™å°±ç·’ï¼ŒReact å°‡ä½¿ç”¨ [RSC è² è¼‰](https://nextjs.org/docs/app/building-your-application/rendering/server-components#what-is-the-react-server-component-payload-rsc)ä¾†èª¿å’Œå®¢æˆ¶ç«¯å…ƒä»¶å’Œä¼ºæœå™¨å…ƒä»¶æ¨¹ï¼Œä¸¦æ›´æ–° DOMã€‚

# Routingâ€”â€”è·¯ç”±ä½¿ç”¨å·®ç•°

_ï¼ˆæ’°å¯«ä¸­ï¼‰_

# Data Fetchingâ€”â€”è³‡æ–™ç²å–å·®ç•°

_ï¼ˆæ’°å¯«ä¸­ï¼‰_

# é€æ­¥é·ç§»çš„æ–¹å¼

_ï¼ˆæ’°å¯«ä¸­ï¼‰_

# å¯¦ä½œâ€”â€”App Router

_ï¼ˆå¾…å¯¦ä½œï¼‰_

# çµè«–

### åˆæ­¥æ¢åˆ—å¼æ•´ç†å·®ç•°â€”â€”App Router vs Page Router

_ï¼ˆå†æ•´ç†ï¼‰_

- App Router åœ¨ Â `app`Â  ç›®éŒ„åº•ä¸‹ï¼›Page Router åœ¨ Â `page`åº•ä¸‹
- éƒ½æ˜¯ç”±ç›®éŒ„çµæ§‹ç”¢ç”Ÿå¯¦éš›è·¯ç”±ï¼Œä½†å…©é‚Šè·¯ç”±ä¸å¯é‡è¤‡ã€‚å³`app/profile/page.tsx`Â  èˆ‡ Â `page/profile.tsx`æœƒç”¢ç”Ÿç›¸åŒè·¯å¾‘ï¼ŒåŸ·è¡Œæ™‚æœƒå™´éŒ¯æé†’
- Page Router ç†Ÿæ‚‰çš„`_document.tsx`,Â `_app.tsx`ï¼ŒApp Router å·²ä¸ä½¿ç”¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯`app/layout.tsx`ã€‚æ‰€ä»¥ RootLayout è£¡éœ€è¦è‡ªè¡Œå¯«`<html><body>`é€™äº›ï¼Œå› ç‚º Next ä¸æœƒè‡ªå‹•ç”¢ç”Ÿ
- å¾Œç«¯ API è·¯å¾‘çµæ§‹ä¸€æ¨£ï¼Œéƒ½æ˜¯`/api/`åº•ä¸‹ã€‚å³`page/api/user.tsx`ç­‰æ–¼`app/api/user/route.tsx`ï¼Œéƒ½æœƒç”¢ç”Ÿ`/api/user`ã€‚èˆ‡è·¯ç”±ä¸€æ¨£ï¼Œç›¸åŒ api åœ¨ page èˆ‡ app ä¸å¯é‡è¤‡
- è’é›†ç¶²å€åƒæ•¸(å‹•æ…‹è·¯ç”±)å‘½åä¸€æ¨£æ˜¯`[param]`æˆ–`[...params]`ï¼Œå·®åˆ¥åœ¨ App Router åƒ…èƒ½æ˜¯ç›®éŒ„ï¼Œè€Œ Page Router å¯ä»¥æ˜¯æª”å
- åœ¨çµ„ä»¶è£¡å–å¾—è·¯ç”±(Dynamic route)åƒæ•¸ï¼ŒPage Router æ˜¯ç”¨`useRouter()`ï¼› App Router æ˜¯ç›´æ¥åœ¨ props å‚³å…¥ï¼Œå¦‚ Â `page({params})`

### æ·±å…¥æ¢åˆ—å¼æ•´ç†å·®ç•°â€”â€”ä»¥ App Router ç‚ºè¦–è§’

_ï¼ˆå†æ•´ç†ï¼‰_

- React Component é ˆä½¿ç”¨`'use client'`,Â `'use server'`æ¨™è¨˜çµ„ä»¶é¡å‹
- `app/`ç›®éŒ„åº•ä¸‹ä¸æ¨™è¨˜çš„è©±ï¼Œé è¨­çš†æ˜¯ RSC(React Server Component)
- åªè¦çµ„ä»¶æœ‰å‚³éåˆ°`onClick`ä¹‹é¡çš„èˆ‡ user äº’å‹•çš„ functionï¼Œçš†é ˆç‚º client çµ„ä»¶ã€‚å®˜æ–¹æ¨è–¦å¯ä»¥å–®ç´”å°‡å…¶åŒ…æˆä¸€å°çµ„ä»¶ä¸¦å®£å‘Š`'use client'`
- Server èˆ‡ Client çµ„ä»¶å¯ä»¥äº¤éŒ¯å»ºç«‹æˆä¸€æ£µæ¨¹ï¼Œ**å”¯é ˆæ³¨æ„ props ä¸å¯ç‚º Â `Date`,Â `function`Â  ç­‰ç„¡æ³•è¢« json åºåˆ—åŒ–çš„å‡½å¼**
- å®£å‘Š`'use client'`å¾Œï¼Œå…¶åº•ä¸‹å¼•å…¥ä½¿ç”¨çš„çµ„ä»¶ä¸å¿…ç‰¹åˆ¥å®£å‘Šï¼Œè‡ªå‹•ç•¶ä½œ`client`ã€‚ç›´åˆ°å†æ¬¡é‡åˆ°`'use server'`ï¼Œè€Œ`server`åº•ä¸‹å¼•å…¥çš„çµ„ä»¶äº¦åŒã€‚è‡ªå‹•è¦–ç‚º`server`çµ„ä»¶ç›´åˆ°é‡åˆ°`'use client'`ã€‚æ•…ä¸å¿…åœ¨æ¯å€‹çµ„ä»¶æœ€ä¸Šé¢è²æ˜ Â `client`Â  æˆ– Â `server`ã€‚æ²’è²æ˜çš„çµ„ä»¶ï¼Œè‡ªå·±è¦æ¸…æ¥šä½¿ç”¨ä½ç½®
- RSCÂ **ç„¡æ³•**ä½¿ç”¨ hookã€dom APIï¼Œä½†å¯ä»¥åœ¨çµ„ä»¶è£¡åš Server æ‰èƒ½åšçš„äº‹ï¼Œå¦‚ fs, æŸ¥è©¢ DBâ€¦ç­‰ã€‚è‹¥æœ‰ hook éœ€æ±‚ï¼Œè«‹è½‰æˆ client component
- æ‰€æœ‰çš„é é¢ç¯€é»ä¸€å¾‹ç”±å›ºå®šæª”å`page.tsx(js)`æ‰æœƒè¢«æ¸²æŸ“æˆè·¯ç”±ï¼Œæ•…ç›¸åŒåŠŸèƒ½çµ„ä»¶å¯ç½®æ–¼`app/`ç›®éŒ„åº•ä¸‹ï¼Œé›†ä¸­ç®¡ç†ã€‚ä¸å¿…æ”¾åœ¨å¤–é¢è®“æª”æ¡ˆè·é›¢é™é ï¼Œæ›´æ˜“æ–¼ç®¡ç†
- æ‰€æœ‰ API ç¯€é»ä¸€å¾‹ç”±`route.ts(js)`æ‰æœ‰å…¶ apiã€‚æª”æ¡ˆç®¡ç†å„ªé»åŒä¸Šã€‚è£¡é¢å‰‡é¡å¤–`export function GET`,Â `export const POST`ç­‰æŒ‡å®š API method
- page é é¢æ²’æœ‰`getServerSideProps`,Â `getStaticPaths`Â  ç­‰å‡½å¼ï¼Œåªæœ‰ export react component
- ä¸åŒé€£çµè¦ä½¿ç”¨ç›¸åŒ layoutï¼Œå¯å»ºç«‹`/(group)/`ç›®éŒ„ä¾†åˆ†çµ„ï¼Œå…¶ä¸­`(group)`ä¸æœƒè¢«æ¸²æŸ“æˆè·¯å¾‘ã€‚å¦‚`app/(group)/abc/edf`Â ->`/abc/edf`
- é¡å¤–æä¾›`headers`èˆ‡`cookies`å¯ä»¥åœ¨ RSC æˆ– API ä½¿ç”¨ã€‚å…·é«”ç”¨æ³•å¯åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://nextjs.org/docs/app/api-reference/functions/cookies)ã€‚**è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Page Router ç„¡æ³•ä½¿ç”¨ã€‚è‹¥åœ¨ Page Router ä½¿ç”¨ï¼Œæœƒè¼¸å‡º`undefined`**
- åœ¨ RSC ä½¿ç”¨ Â `fetch`Â Call API æ™‚ï¼Œä»–çš„ fetch æ˜¯ç¹¼æ‰¿ native fetch å¾Œå†å¢åŠ ä¸€äº› next å°ˆå±¬åŠŸèƒ½ï¼Œå¦‚ cache ï¼Œäº¦æœ‰å°ˆå±¬çš„ Â `next: {...}`Â  åƒæ•¸å¯ä½¿ç”¨
- ä»¥ä¸‹æª”åæ˜¯ next å°ˆå±¬æª”åï¼Œæœƒè¢« next è™•ç†ã€‚ä¸èƒ½æ‹¿ä¾†åšç‚ºè‡ªå·±çš„å­çµ„ä»¶å‘½åã€‚
  - page
  - layout
  - route
  - loading
  - not-found
  - error
  - global-error
  - template
  - default
- æœƒæœ‰å…¨åŸŸ provider (å¦‚ redux, react query)çš„ä¸‰æ–¹å¥—ä»¶ã€‚å®˜æ–¹æ¨è–¦é‡å°ä»–å¢åŠ ä¸€å€‹`provider.tsx`ï¼Œåœ¨æœ€ä¸Šå±¤ä½¿ç”¨`'use client'`ï¼Œå†æ”¾åˆ°`layout.tsx`è£¡ã€‚å…·é«”ç¯„ä¾‹å¯åƒè€ƒ[å®˜æ–¹ / Rendering third-party context providers in Server Components](https://nextjs.org/docs/getting-started/react-essentials#rendering-third-party-context-providers-in-server-components)
- è‹¥æœ‰äº›å‡½å¼å¯èƒ½åŒ…å«æ©Ÿå¯†è³‡è¨Šï¼Œä½†å¯«æ³•åˆå¯ä»¥åœ¨ Client é‹ä½œï¼Œæƒ³è¦é™åˆ¶ä»–åƒ…èƒ½åœ¨ Server çš„è©±ï¼Œå¯ä½¿ç”¨`server-only`å¥—ä»¶ä¿è­·ã€‚ç”¨æ³•å¯è¦‹[å®˜æ–¹ / The â€œserver onlyâ€ package](https://nextjs.org/docs/getting-started/react-essentials#the-server-only-package)

### é©ç”¨æƒ…å¢ƒ

_ï¼ˆæ’°å¯«ä¸­ï¼‰_

### å°æ–¼å°ˆæ¡ˆçš„å»ºè­°

_ï¼ˆæ’°å¯«ä¸­ï¼‰_

# åƒè€ƒè³‡æ–™

_ï¼ˆæ’°å¯«ä¸­ï¼‰_
