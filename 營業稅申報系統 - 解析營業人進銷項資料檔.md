# 營業稅申報系統 - 解析營業人進銷項資料檔

## 前言
營業稅媒體申報是現代企業稅務管理中的一個重要環節。隨著數位化時代的來臨，企業需要以電子方式提交進、銷項資料，以確保稅務申報的準確性和及時性。這不僅有助於提升企業的運營效率，還能減少人工錯誤，確保稅務合規。

進、銷項資料檔是營業稅申報的核心部分，包含了企業在特定期間內的所有銷售和購買交易記錄。這些資料需要按照特定的格式和規範進行整理和提交，以便稅務機關能夠準確地進行審核和處理。

由於進、銷項資料檔融合了進項資料及銷項資料，並且需要判斷是否為彙加資料，進而將這些資訊解析後以81字元顯示，本文利用圖說方式解析相關文件，以利於理解及程式碼開發。

## 營業稅建檔程式步驟 5 / 營業稅審核程式步驟 1  
營業稅申報系統分為建檔程式及審核程式，先建立營業人進銷項資料檔可以完成下列分別步驟：
- 建檔程式：步驟5，建檔程式有完整的申報流程，依照流程圖順序操作即可完成申報作業
- 審核程式：步驟1，若已產生網路申報所需的電子媒體檔，可以不透過建檔程式操作，直接使用審核程式針對媒體檔案進行審核、上傳作業

![CleanShot 2024-08-01 at 15 24 24@2x](https://github.com/user-attachments/assets/648a26f0-002b-4f6a-b555-37aaa8bd4564)
![CleanShot 2024-08-01 at 15 24 54@2x](https://github.com/user-attachments/assets/3ef93bf1-1d84-4015-8ef7-7a45f01e2199)

## 營業人進銷項資料檔案格式說明
營業人進銷項資料檔將進項資料、銷項資料及是否為彙加資料融合在81長度中，稍微複雜，下方將利用圖例方式解析，以利於理解。
- 檔案格式
  根據「營業稅電子資料申報繳稅作業要點」，營業人進銷項資料檔為長度81字之txt檔，檔名為營業人統一編號
  
  ![CleanShot 2024-08-01 at 15 31 12](https://github.com/user-attachments/assets/ee97419a-d236-454a-824f-b4c9801d754b)
  <img width="461" alt="CleanShot 2024-08-01 at 16 12 34@2x" src="https://github.com/user-attachments/assets/f9592c28-361a-43e5-873f-95ff56f06225">



- 根據「營業稅電子資料申報繳稅作業要點」第20項欄位詳細說明及第38頁（附件五）檔案格式欄位對照表：

  ![CleanShot 2024-08-01 at 15 40 36](https://github.com/user-attachments/assets/d7b127a6-0a77-4b03-ac10-c4b7be3ebf14)

  這裡擷取共用欄位，其餘細則請參見「營業稅電子資料申報繳稅作業要點」第20項營業人進、銷項資料檔格式
  - 格式代號
    - 格式代號 21~29 屬於進項資料
    - 格式代號 31~38 屬於銷項資料
  - 共有四組欄位共用
    - （欄位位置 24-31）買受人統一編號 / 發票訖號
      - 屬於彙加資料
        - 銷項資料：為連續發票之訖號
      - 非屬銷項資料：進貨營業人統一編號，如無則為空白
    - （欄位位置 40-49）其他憑證號碼 / 公用事業載具流水編號
    - （欄位位置 50-61）銷售金額 / 營業稅稅基
      - 進項資料：營業稅稅基
      - 銷項資料：銷售金額
    - （欄位位置 80-80）彙加註記 / 分攤註記
      - A > 屬於彙加資料
        - 相依邏輯： 
          - 進項資料：第 32-35 欄為彙總張數
          - 銷項資料：第 24-31 欄為發票訖號
      - B > 屬於進項憑證分攤資料
        - 相依邏輯： 
          - 僅限格式代號為 25 時使用
          - 第 32-39 欄為銷售人統一編號
      - 空白 > 非彙加資料
        - 相依邏輯：
          - 進項資料：第 32-39 欄為銷售人統一編號
          - 銷項資料：第 24-31 欄為買受人統一編號
  - 依照屬性為進項或銷項資料及是否為彙加資料，欄位有多種排列組合（紅框框處）

## 圖例解析
是否被以上說明搞得頭昏眼花呢？以下提供圖例對應各種情況之欄位使用，在此之前需先分析該資料兩種屬性
- 進項資料 或是 銷項資料
- 彙加資料 或是 非彙加資料

針對欄位 24-61 說明組合：
- 進項資料
  - 彙加資料
    - 一般進項
       
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-35    | 彙總張數 |
    | 36-39    | 空白 |
    | 40-41    | 發票字軌 |
    | 42-49    | 發票(起)號碼 |
    | 50-61    | 營業稅稅基 |

    - 有`公用事業載具流水號`
   
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-35    | 彙總張數 |
    | 36-39    | 空白 |
    | 40-49    | 公用事業載具流水號 |
    | 50-61    | 營業稅稅基 |

    - 有`其他憑證號碼`
   
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-35    | 彙總張數 |
    | 36-39    | 空白 |
    | 40-49    | 其他憑證號碼 |
    | 50-61    | 營業稅稅基 |
  - 非彙加資料
    - 一般進項
       
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-39    | 銷售人統一編號 |
    | 40-41    | 發票字軌 |
    | 42-49    | 發票(起)號碼 |
    | 50-61    | 營業稅稅基 |

    - 有`公用事業載具流水號`
   
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-39    | 銷售人統一編號 |
    | 40-49    | 公用事業載具流水號 |
    | 50-61    | 營業稅稅基 |

    - 有`其他憑證號碼`
   
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-39    | 銷售人統一編號 |
    | 40-49    | 其他憑證號碼 |
    | 50-61    | 營業稅稅基 |

    - 有`海關代徵營業稅繳納證號碼`
   
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 |
    | 32-35    | 空白 |
    | 36-49    | 海關代徵營業稅繳納證號碼 |
    | 50-61    | 營業稅稅基 |
- 銷項資料
  - 彙加資料
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 發票訖號 |
    | 32-39    | 銷售人統一編號 |
    | 40-41    | 發票字軌 |
    | 42-49    | 發票(起)號碼 |
    | 50-61    | 銷售金額 |
  - 非彙加資料
    | 欄位起始 | 欄位說明               |
    | -------- | ---------------------- |
    | 24-31    | 買受人統一編號 or 空白 |
    | 32-39    | 銷售人統一編號 |
    | 40-41    | 發票字軌 |
    | 42-49    | 發票(起)號碼 |
    | 50-61    | 銷售金額 |

![CleanShot 2024-08-05 at 10 45 01](https://github.com/user-attachments/assets/58224539-8521-4908-bbb7-6121fd5fb5c1)


## 轉換成 txt 結果圖說
- 以一筆`銷項 - 分攤憑證`為範例
- 先提供所需資料

<img width="285" alt="CleanShot 2024-08-02 at 11 30 13@2x" src="https://github.com/user-attachments/assets/3bec29d9-46fa-464e-a96b-0daa30ca9fbc">

- 再運用程式碼組合
  - 依據傳入資料類型決定組合方式
  - 使用 padding 補齊左側缺少的0 

![CleanShot 2024-08-02 at 12 17 46](https://github.com/user-attachments/assets/4796a029-564e-460a-800f-e1bfea169e68)


- 輸出結果，長度共81位：

![CleanShot 2024-08-02 at 11 32 47@2x](https://github.com/user-attachments/assets/5eb43b57-b433-492e-9b03-59bd909a2e1d)

- 1：長度2，格式代號，文數字型態
- 2：長度9，申報營業人稅籍編號，文數字型態，不足位數左側補齊0 
- 3：長度7，流水號，文數字型態，不足位數左側補齊0 
- 4：長度3，資料所屬年度，數字型態，不足位數左側補齊0 
- 5：長度2，資料所屬月份，數字型態，不足位數左側補齊0 
- 6：長度8，買受人統一編號，文數字型態
- 7：長度8，銷售人統一編號，文數字型態
- 8：長度2，發票字軌，文數字型態
- 9：長度8，發票號碼，數字型態，不足位數左側補齊0 
- 10：長度12，銷售金額，數字型態，不足位數左側補齊0 
- 11：長度1，課稅別，文數字型態
- 12：長度10，營業稅額，數字型態，不足位數左側補齊0 
- 13：長度1，扣抵代號，文數字型態，空白有其代表意義
- 14：長度5，空白，文數字型態
- 15：長度1，特種稅額稅率，文數字型態，空白有其代表意義
- 16：長度1，彙加註記／分攤註記，文數字型態，空白有其代表意義
- 17：長度1，通關方式註記，文數字型態，空白有其代表意義

各種進、銷項資料有不同的排列組合，要特別注意!

## 結論
本文利用圖例和詳細的欄位說明，幫助理解進、銷項資料檔的結構和各欄位的意義。這些資訊對於開發和維護營業稅申報系統至關重要，能夠幫助開發者準確地生成符合規範的資料檔案，從而簡化稅務申報流程。

希望本文能夠為您提供有價值的參考，幫助您更好地理解和實作營業稅申報系統中的進、銷項資料檔案。透過這些知識，您將能夠更有效地管理企業的稅務申報工作，確保資料的完整性和正確性。

本文使用的資料截至2024年7月止，未來若有法規變化，可能會影響資料格式和申報流程，參考本文時請先確認最新資訊。




